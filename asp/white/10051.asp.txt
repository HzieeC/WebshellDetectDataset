<%

Dim UserAgent
UserAgent = Trim(Lcase(Request.Servervariables("HTTP_USER_AGENT")))
If InStr(UserAgent,"teleport")>0 or InStr(UserAgent,"webzip")>0 or InStr(UserAgent,"flashget")>0 or InStr(UserAgent,"offline")>0 Then
	Response.Write "Please don't use the Teleport/Webzip/Flashget/Offline etc. tool view web page"
	Response.End
End If

Function ChkPost()
	Dim server_v1,server_v2
	Chkpost = False
	server_v1 = Cstr(Request.ServerVariables("HTTP_REFERER"))
	server_v2 = Cstr(Request.ServerVariables("SERVER_NAME"))
	If Mid(server_v1,8,Len(server_v2)) = server_v2 Then Chkpost = True
End Function

Function IsHing()
	If TypeName(conn)<>"Nothing" Then
		conn.Close
		Set conn=Nothing
	End If
End Function

Function IsNum(Str)
	IsNum = True
	IF IsNull(Str) Then
		IsNum = False
		Exit Function
	End IF
	IF Not IsNumeric(Str) Or Cstr(Str) = "" Then
		IsNum = False
		Exit Function
	End IF
End Function

Function IsStr(Str)
	If Str = "" Then
		IsStr = ""
		Exit Function
	End If
	Str = Trim(Str)&""
	Str = Replace(Str,"'","&#39;")
	Str = Replace(Str,":","")
	Str = Replace(Str,"--","－－")
	IsStr = Str
End Function

Function Strleft(Str,L)
	IF IsNull(Str) Then Exit Function
	Dim Temp_Str,Test_Str,Lens,I
	Str = Trim(Str)
	L = Cint(L)
	Temp_Str = Len(Str)
	For I = 1 To Temp_Str
		Test_Str = (Mid(Str,I,1))
		Strleft = Strleft & Test_Str
		If Asc(Test_Str) > 0 Then
			Lens = Lens + 1
		Else
			Lens = Lens + 2
		End If
		If Lens >= L Then Exit For
	Next
End Function

Function StrLength(Str)
	Temp_Str = Len(Str)
	For I = 1 To Temp_Str
		Test_Str = (Mid(Str,I,1))
		IF Asc(Test_Str) > 0 Then
			StrLength = StrLength + 1
		Else
			StrLength = StrLength + 2
		End IF
	Next
End Function

Function chkBadWords(Str)
	Dim BadWords	
	Dim bwords,ii
	BadWords = "顶级|最佳|极品|最高级|国家级|最大|第一|唯一|独家|独享|领先|首席|专利号|国家专利|零风险|0风险|投资回报|回报周期|利润分析|奥运|政府|人大|政协|军队|武警|市场占有率|消费者首选品牌|全国销量第|全球销量第|移民"
	If Not(isnull(BadWords) or isnull(Str)) Then
		bwords = split(BadWords, "|")
		For ii = 0 To Ubound(bwords)
			Str = Replace(Str, bwords(ii), String(Len(bwords(ii)),"*"))
		Next
	End If
	chkBadWords = Str
End Function

Function CodeCookie(str)
	Dim strRtn
	For i = Len(str&"") To 1 step - 1
		strRtn = strRtn & AscW(Mid(str,i,1))
		If (i<>1) Then strRtn = strRtn & "a"
	Next
	CodeCookie = strRtn
End Function

Function Ubb2Txt(Str)
	IF IsNull(Str) Then Exit Function
	Dim Re
	Set Re = New RegExp
	Re.IgnoreCase = True
	Re.Global = True
	Re.Pattern = "<.+?>"
	Str = Re.Replace(Str,"")
	re.Pattern="(\[\/IMGA\])"
	Str=re.Replace(Str,"[/IMGA]" & VbCrLf)
	re.Pattern="\[IMGA=.+?\].+?\[\/IMGA]"
	Str=re.Replace(Str,"")
	re.Pattern="\[IMGA\].+?\[\/IMGA]"
	Str=re.Replace(Str,"")
	Str = Replace(Str,VbCrLf,"")
	re.Pattern="(\[\/IMG\])"
	Str=re.Replace(Str,"[/IMG]" & VbCrLf)
	re.Pattern="\[IMG=.+?\].+?\[\/IMG]"
	Str=re.Replace(Str,"")
	re.Pattern="\[IMG\].+?\[\/IMG]"
	Str=re.Replace(Str,"")
	Str = Replace(Str,VbCrLf,"")
	Re.Pattern = "\[.+?\]"
	Str = Re.Replace(Str,"")
	Set Re = Nothing
	Str = Replace(Str, "&nbsp;", "")
	Str = Replace(Str, " ", "")
	Str = Replace(Str, "　", "")
	Str = Replace(Str, CHR(9), "")
	Str = Replace(Str, CHR(13), "")
	Str = Replace(Str, CHR(10), "")
	Ubb2Txt = Str
End Function

Function htmlEncode(str)
	If str & "" <> "" Then
		htmlEncode=Replace(Replace(Replace(str,">","&gt;"),"<","&lt;"),"""","&quot;")
	Else
		htmlEncode=str
	End If
End Function

Function PrintTrueText(tempString)
	If tempString<>"" Then
		PrintTrueText=Replace(Replace(Replace(Replace(Replace(htmlEncode(tempString),VbCrLf & " ","<br>" & "&nbsp;"),VbCrLf,"<br>"),"   "," &nbsp; "),"  "," &nbsp;"),chr(9)," &nbsp; &nbsp; &nbsp;")

		If Left(PrintTrueText,1) = chr(32) Then
			PrintTrueText = "&nbsp;" & Mid(PrintTrueText,2)
		End If
	Else
		PrintTrueText=""
	End If
End Function

Function FiltrateBadWords(tempStr)
	Dim re
	Set re = New RegExp
	re.Global = True
	re.IgnoreCase = True

	Dim Str
	Str = tempStr
	Dim CFW_FilterString_Temp,i,Temp_N
	CFW_FilterString_Temp = split(CFW_FilterString, "|")
	Temp_N = ubound(CFW_FilterString_Temp)
	For i = 0 to Temp_N
		re.Pattern="(" & CFW_FilterString_Temp(i) & ")"
		Str=re.Replace(Str,string(len(CFW_FilterString_Temp(i)),"*"))
	Next
	Set Re = Nothing
	FiltrateBadWords = Str
End Function

Function Asp2Txt(durl,dpath,v)
	On Error Resume Next
	Asp2Txt = False
	IF dpath = "" Then Exit Function
	IF v = 0 Then
		IF durl = "" Then Exit Function
		Dim objXmlHttp,objAdoStream,binFileData
		Set objXmlHttp = Server.CreateObject("Microsoft.XMLHTTP")
		objXmlHttp.Open "GET", durl, False
		objXmlHttp.send()
		if objXmlHttp.readystate = 4 then
		else
			response.write "<LI>获取失败,重试!<br>"
			response.Flush()
			Asp2Txt = False
			exit function
		end if
		binFileData = objXmlHttp.responseBody
		Set objXmlHttp = Nothing
		Set objAdoStream = Server.CreateObject("ADODB.Stream")
		objAdoStream.Type = 1
		objAdoStream.Open()
		objAdoStream.Write(binFileData)
		objAdoStream.SaveToFile dpath, 2
		objAdoStream.Close()
		Set objAdoStream = Nothing
	Else
		Set fso = Server.CreateObject("Scripting.FileSystemObject")
		IF fso.FileExists(dpath) Then fso.DeleteFile(dpath)
		Set fso = nothing
	End IF
	Asp2Txt = True
	IF Err.Number<>0 Then Err.Clear
End Function

Function Comp2Txt(v,n,m)
	IF Not IsNum(n) Then Exit Function
	IF Not IsNum(m) Then Exit Function
	Dim FilePath
	FilePath = Server.MapPath(MyPath & "com/")
	Select Case v
	Case 0
		'AspUrl = "http://search.ppjm8.com/skins/0.asp?id=" & n
		FilePath = FilePath & "\c1\" & n & ".htm"
		
		Call UpItems(n,FilePath,m)
		'response.Write "首页<br>"
	Case 1
		FilePath = FilePath & "\coms\" & n & "\"
		Call CreateDIR(FilePath)
		
		FilePatha = FilePath & "tp.htm"  '图片展示
		Call UpItem("p",n,FilePatha,m)
		
		FilePatha = FilePath & "ys.htm"  '投资优势
		Call UpItem("t",n,FilePatha,m)
	
		FilePatha = FilePath & "lc.htm"  '加盟流程
		Call UpItem("j",n,FilePatha,m)
		
		FilePatha = FilePath & "zx.htm"  '在线咨询
		Call UpItem("z",n,FilePatha,m)
		
		'FilePatha = FilePath & "m.htm"
		'Call UpItem("m",n,FilePatha,m)
		
		'FilePatha = FilePath & "l.htm"
		'Call UpItem("l",n,FilePatha,m)
		
		'FilePatha = FilePath & "y.htm"
		'Call UpLiuYan(n,FilePatha,m)
	'Case 3
		'FilePath = Server.MapPath(MyPath & "CompTj/")
		'FilePath = FilePath & "\stat\" & n & ".htm"
		'Call Uptop(n,FilePath,m)
	Case 4
		FilePath = FilePath & "\coms\" & n & "\"
		Call CreateDIR(FilePath)
		
		FilePatha = FilePath & "y.htm"
		Call UpLiuYan(n,FilePatha,m)
	Case Else
		Exit Function
	End Select
End Function

Function UBB_Codes(Str)

	Dim USC
	USC = Str
	USC = Replace(USC,VbCrLf,chr(3))
	dim re
	set re = New RegExp
	re.Global = True
	re.IgnoreCase = True

	re.Pattern="(javascript|jscript|js|about|file|vbscript|vbs)(:)"
	USC=re.Replace(USC,"$1&#58;")
	re.Pattern="(document)(.)(cookie)"
	USC=re.Replace(USC,"$1&#46;$3")
	re.Pattern="(on(mouse|exit|error|click|key))"
	USC=re.Replace(USC,"&#111;n$2")

'	re.Pattern="(\[\/URL\])"
'	USC=re.Replace(USC,"[/URL]" & VbCrLf)
'	re.Pattern="(\[URL\])(.*)(\[\/URL\])"
'	USC= re.Replace(USC,"$2")
'	USC = Replace(USC,VbCrLf,"")
'
'	re.Pattern="(\[\/URL\])"
'	USC=re.Replace(USC,"[/URL]" & VbCrLf)
'	re.Pattern="(\[URL=(.[^\[]*)\])(.*)(\[\/URL\])"
'	USC= re.Replace(USC,"$3")
'	USC = Replace(USC,VbCrLf,"")
	
	UBB_Codes = USC
	Set Re = Nothing
End Function

Function ShowNull(str,n)
	ShowNull = str
	if str&"" = "" then ShowNull = "暂空"
End Function

Function CreateDIR(FolderName)'建立新闻存储目录
	On Error Resume Next
	Dim FileObject,PathArr,Path_Level,I,PathTmp,CPath
	FolderName = Replace(FolderName, "\", "/")
	Set FileObject = Server.CreateObject("Scripting.FileSystemObject")
	IF FileObject.FolderExists(FolderName) Then
		Set FileObject = Nothing
		CreateDIR = True
		Exit Function
	End IF
	PathArr = Split(FolderName, "/")
	Path_Level = UBound(PathArr)
	For I = 0 To Path_Level
		IF I = 0 Then PathTmp = PathArr(0) & "/" Else PathTmp = PathTmp & PathArr(I) & "/"
		CPath = Left(PathTmp, Len(PathTmp) - 1)
		IF Not FileObject.FolderExists(CPath) Then FileObject.CreateFolder CPath
	Next
	Set FileObject = Nothing
	IF Err.Number <> 0 Then
		CreateDIR = False
		Err.Clear
	Else
		CreateDIR = True
	End IF
End Function

Function Links()
	Dim WebUrl,Trait,Str
	'WebUrl = "http://" & Cstr(Request.ServerVariables("SERVER_NAME")) & Cstr(Request.ServerVariables("SCRIPT_NAME"))
	WebUrl=CFW_WebUrl
	'response.Write WebUrl
	Set ls=conn.Execute("select top 1 ID from CFW_LINK_TRAIT where PATINDEX(TRAIT,'" & WebUrl & "')>0")
	IF Not ls.EOF Then
		Trait = "," & ls(0) & ","
	End If
	ls.Close
	Set ls=Nothing
	IF Trait = "" or Trait = ",," Then Exit Function
	if trait = ",1," then
		sql = "select HOMENAME,HOMEURL from CFW_LINK where VID=2 and CHARINDEX('" & Trait & "',TRAIT)>0"
	else
		sql = "select HOMENAME,HOMEURL from CFW_LINK where VID=2 and CHARINDEX('" & Trait & "',TRAIT)>0 order by newid()"
	end if
	Set ls=conn.Execute(sql)
	Do While Not ls.EOF
		Str = Str & "<nobr><a href=""" & ls(1) & """ target=_blank>" & ls(0) & "</a></nobr> "
		ls.MoveNext
	Loop
	ls.Close
	Set ls=Nothing
	conn.Close
	Set conn=Nothing
	'Str = Str & "<a href="""&CFW_WebUrl&"LinkList.asp"" target=_blank>更多>></a>"
	Links = Str
End Function

Function CookLogin_i()
	dim indi_user,indi_pasd
	CookLogin_i = 0
	indi_user = IsStr(Request.Cookies("INDI")("USERNAME"))
	indi_pasd = IsStr(Request.Cookies("INDI")("PASSWORD"))
	if indi_user <> "" and indi_pasd <> "" then
		set ls = conn.Execute("select PASSWORD,ID from CFW_USER_INDI_CY where USERNAME='" & indi_user & "'")
		if not ls.eof then
			if LCase(ls(0)) = LCase(indi_pasd) Then CookLogin_i = ls(1)
		end if
		ls.close
		set ls = nothing
	end if
End Function

function UpItem(at,n,filepatha,v)
	if Not IsNum(n) then exit function
	if at="" then exit function
	if filepatha = "" then exit function
	laid = n
	id = n
	if v = 0 then
		dim urvid,sid
		dim logo,ppmc,gsmc,tel,compurl,tzje,tpstr,pptitle
		dim fso,newfile,sourcetext,sourcefile
		dim strjycp
		strjycp=""
		tpstr =  ""
		Set ls = conn.execute("select ID,SID,NID,VID,UR_LOGO,UR_PPMC,UR_TITLE,UR_GSMC,UR_TEL,UR_TZJE,UR_JMALL,UR_JYCP,UR_TEL,UR_MDNUM,isnull(UR_JBTSE,'') UR_JBTSE from CFW_USER_COMP where ID=" & n)
		if ls.eof then 
		else
		'response.Write "ok33"
			compurl = Comp2Skin(ls("ID"),ls("NID"))
			sid = ls("SID")
			urvid = ls("VID")
			logo = ls("UR_LOGO")
			ppmc = Strleft(ls("UR_PPMC"),22)
			pptitle = ls("UR_TITLE")
			gsmc = ls("UR_GSMC")
			tel = ls("UR_TEL")
			tzje = ls("UR_TZJE")
			tzje = replace(tzje,"-"," - ")
			jmall = Split(ls("UR_JMALL"),"$$")
			jmall2 = jmall(2)
			strjycp = ls("UR_JYCP")
			mdnum = ls("UR_MDNUM")
			jbtse = ls("UR_JBTSE")
			conv2selectsid2 = Conv2Select(ls("SID"),2)
			
			
			ls.close
			set ls = nothing
			if urvid = 0 then	
				Set fso = server.CreateObject("Scripting.FileSystemObject")
				Set newfile = fso.opentextfile(filepatha, 2, TRUE)
				newfile.write("<li>该品牌未通过审核,请与我们联系！")
				Set newfile = noting
				Set fso=Nothing
			else
				if logo&"" = "" then
					set ls = conn.execute("select Top 1 PICDIR from CFW_USER_COMP_PIC where SID=" & laid & " order by TID desc,ID desc")
					if not ls.eof then
						logo = SerchLogo(ls(0),"0")
					else
						logo = CFW_WebUrl&"com/images/no.JPG"
					end if
					ls.close
					set ls = nothing
				end if
				
				    
		if urvid<> 5 then	
        		
		        strcontent1 = strcontent1&"<tr>" & vbNewLine
        		    
         strcontent1 = strcontent1&"<td class=""comInfo"" align=right>联系电话：</td>" & vbNewLine
         strcontent1 = strcontent1&"<td colspan=3 class=""comInfo"" align=left >&nbsp;&nbsp;"&tel&"</td>" & vbNewLine
         strcontent1 = strcontent1&"</tr>" & vbNewLine
         else
         strcontent1=""
		 end if
				select case at
				case "t"
				dim Form_Content
				set ls = conn.execute("select CONTENT from CFW_USER_COMP_TXT where ID=" & laid & " and TID=1")
				if not ls.eof then
					Form_Content = ls(0)
				else
					Form_Content = conn.execute("select UR_QYJJ from CFW_USER_COMP where ID=" & laid)(0)
				end if
				ls.close
				set ls = nothing
				Set fso = Server.CreateObject("Scripting.FileSystemObject")
					Set sourceFile = fso.OpenTextFile(Server.MapPath("..\com\skins\c3.htm"),1)
					sourceText = sourceFile.ReadAll
					sourceFile.Close
				Set sourceFile = Nothing
				Form_Content=Replace(Replace(chkBadWords(Ubb_code(Form_Content)) & "","\" & VbCrLf,"\\" & VbCrLf & VbCrLf),"'","''")	
				sourcetext = Replace(sourcetext,"{$Form_Content$}",Form_Content)
				case "p"
					Set ls = conn.Execute("select Top 8 PICDIR,PICREAD from CFW_USER_COMP_PIC where SID=" & laid & " order by TID desc")
					if not ls.eof then
						tpstr = tpstr&"<table width=""100%"" border=""0"" align=""center"" cellpadding=""15"" cellspacing=""8"">" & vbNewLine
						dim j
						j = 0
						do while not ls.eof
							tpstr = tpstr&"<tr>"
							for i=0 to 1
								if ls.eof then
									tpstr = tpstr&"<td width=""50%"" align=""center""  ></td>" & vbNewLine
								else
									URlPICDIR = Server.URLEncode(ls("PICDIR")&"")
									urlppmc = Server.URLEncode(ppmc)
									PICREAD = ls("PICREAD")
									url ="?v="&URlPICDIR&"&n="&urlppmc&""		
									tpstr = tpstr&"<td width=""50%"" align=""center""  ><table align=center border=""1""><tr><td valign=middle >" & vbNewLine
									tpstr = tpstr&"<a href="""&ls("PICDIR") & vbNewLine
									tpstr = tpstr&"""  target=_blank><img src="""
									tpstr = tpstr&SerchLogo(ls("PICDIR"),"1")
									tpstr = tpstr&""" border=""0""></a></td></tr></table>"&PICREAD&"</td>" & vbNewLine
									j = j + 1
									ls.movenext
								end if
							next
							tpstr = tpstr&"</tr>"
						loop
						tpstr = tpstr&"</table>"	
					end if
					ls.close
					set ls = nothing
					Set fso = Server.CreateObject("Scripting.FileSystemObject")
						Set sourceFile = fso.OpenTextFile(Server.MapPath("..\com\skins\c2.htm"),1)
						sourceText = sourceFile.ReadAll
						sourceFile.Close
					Set sourceFile = Nothing
					sourcetext = Replace(Sourcetext,"{$tupian$}",tpstr)
				case "j"		
					set ls = conn.execute("select CONTENT from CFW_USER_COMP_TXT where ID=" & laid & " and TID=3")
					if not ls.eof then
						Form_Content = ls(0)
					else
						Form_Content = conn.execute("select UR_QYJJ from CFW_USER_COMP where ID=" & laid)(0)
					end if
					ls.close
					set ls = nothing
					Set fso = Server.CreateObject("Scripting.FileSystemObject")
						Set sourceFile = fso.OpenTextFile(Server.MapPath("..\com\skins\c5.htm"),1)
						sourceText = sourceFile.ReadAll
						sourceFile.Close
					Set sourceFile = Nothing
					Form_Content=Replace(Replace(chkBadWords(Ubb_code(Form_Content)) & "","\" & VbCrLf,"\\" & VbCrLf & VbCrLf),"'","''")	
					sourcetext = Replace(sourcetext,"{$Form_Content$}",Form_Content)
				case "m"	
					dim jmclient
					jmclient = ""
					clientstr = ""
					'Set ls = conn.execute("Select * from CFW_USER_COMP_CLIE where SID=" & laid)
					Set ls = conns.execute("Select ShopName,CFW_USER_INDI_CY.TEL AS ConsultationPho,shopAddress from CFW_user INNER JOIN CFW_USER_INDI_CY ON CFW_user.UserID = CFW_USER_INDI_CY.ID where CFW_USER_COMP_ID='" & laid & "' and flag!=2 and CFW_USER_INDI_CY.UserType=1")
					if not ls.eof then
						jmclient = jmclient&"<table width=""92%"" border=""0"" align=""center"" cellpadding=""2"" cellspacing=""1"" bgcolor=""#84B5DC""><tr><td width=""23%"" align=""center"" valign=""top"" bgcolor=""#E7F4FF"" class=""ti1"">加 盟 商</td><td width=""20%"" align=""center"" valign=""top"" bgcolor=""#E7F4FF"" class=""ti1"">电 话</td><td width=""57%"" align=""center"" valign=""top"" bgcolor=""#E7F4FF"" class=""ti1"">地 址</td></tr>"
						do while not ls.eof
						clientstr = clientstr&"<tr><td align=""center"" valign=""top"" bgcolor=""#FDFEFF"">"&ls(0)
						clientstr = clientstr&"</td><td align=""center"" valign=""top"" bgcolor=""#FDFEFF"">"&ls(1)
						clientstr = clientstr&"<td valign=""top"" bgcolor=""#FDFEFF"">"&ls(2)&"</td></tr>"
						ls.movenext
						loop
						jmclient = jmclient&clientstr&"</table>"
					else
						jmclient = "<div style=""height:350px;"">　　该品牌尚未录入系统，请与我们联系。</div>"
					end if
					ls.close
					set ls = nothing
					conns.close
					set conns = nothing
					Set fso = Server.CreateObject("Scripting.FileSystemObject")
						Set sourceFile = fso.OpenTextFile(Server.MapPath("..\com\skins\c6.htm"),1)
						sourceText = sourceFile.ReadAll
						sourceFile.Close
					Set sourceFile = Nothing
					sourcetext = Replace(sourcetext,"{$jmclient$}",jmclient)
				case "l"
					Set fso = Server.CreateObject("Scripting.FileSystemObject")
						Set sourceFile = fso.OpenTextFile(Server.MapPath("..\com\skins\c7.htm"),1)
						sourceText = sourceFile.ReadAll
						sourceFile.Close
						Set sourceFile = Nothing
				case "z"
					Set fso = Server.CreateObject("Scripting.FileSystemObject")
						Set sourceFile = fso.OpenTextFile(Server.MapPath("..\com\skins\c8.htm"),1)
						sourceText = sourceFile.ReadAll
						sourceFile.Close
						Set sourceFile = Nothing
				case else
					exit function			
				end select	
				
					
	
				Conv2select01 = Conv2Select(0,1)
				Conv2select00 = CompT2Select(0,0)
				Conv2Selectsid = Conv2Select(sid,2)
				'comp2stringsid = Comp2String(15,sid,0)
				'Comp2StringLaid = Comp2String(15,laid,1)
				sourceText = Replace(sourceText,"{$ppmc$}",ppmc)
				sourceText = Replace(sourceText,"{$pp_title$}",pptitle)
				sourcetext = Replace(sourceText,"{$id$}",id)
				sourcetext = Replace(sourcetext,"{$laid$}",laid)
				sourcetext = Replace(sourcetext,"{$ur_logo$}",logo)
				sourcetext = replace(sourcetext,"{$jbtse$}",jbtse)
				
				sourcetext = Replace(Sourcetext,"{$tzje$}",tzje)
				sourcetext = Replace(Sourcetext,"{$Conv2select01$}",Conv2select01)
				sourcetext = Replace(Sourcetext,"{$Conv2select00$}",Conv2select00)
				sourcetext = Replace(Sourcetext,"{$Conv2Selectsid$}",Conv2Selectsid)
				
				sourcetext = Replace(Sourcetext,"{$strcontent1$}",strcontent1)
				
				sourcetext = Replace(Sourcetext,"{$conv2selectsid2$}",conv2selectsid2)
				sourcetext = Replace(Sourcetext,"{$jmall2$}",jmall2)	
					'response.Write "ok2"
				'response.End 	
				sourcetext = Replace(Sourcetext,"{$jycp$}",strjycp)	
									
				sourcetext = Replace(Sourcetext,"{$CFW_WebUrl$}",CFW_WebUrl)
				sourcetext = Replace(Sourcetext,"{$mdnum$}",mdnum)
				Set newFile = fso.OpenTextFile(filepatha,2,True)
					newFile.Write sourceText
					newFile.Close
					Set newFile = Nothing
				Set fso = nothing
			end if
		end if
	else
		Set fso = Server.CreateObject("Scripting.FileSystemObject")
			IF fso.FileExists(filepatha) Then fso.DeleteFile(filepatha)
		Set fso = nothing	
	end if
end function

Function UpItems(n,filepatha,m) 
	id = n
	IF m = 0 then
		Dim ur_ppmc,ur_logo,jmall,fso,sourcefile,sourcetext,newfile,pptitle
		Set ls1 = conn.Execute("Select sid,vid,xid,aid,UR_PPMC,UR_TITLE,UR_LOGO,UR_JMALL,UR_QYJJ,UR_TZJE,UR_PPMCE,UR_GSMC,UR_GSMCE,UR_CLTIME,UR_TXTIME,UR_MDNUM,UR_JMNUM,isnull(UR_ZCZB,'') UR_ZCZB,isnull(UR_NYYE,'') UR_NYYE,isnull(UR_JMQY,'') UR_JMQY,UR_JYCP,isnull(UR_JBTSE,'') UR_JBTSE,UR_GSADD,UR_GSURL,UR_MAIL,UR_TEL,UR_FAX,UR_POST,UR_QQ,UR_MSN,UR_LXR,UR_PPFYD,UR_HBLID,UR_HBZQID,UR_JYMS,UR_FZMS,UR_TZRQ from  CFW_USER_COMP where ID=" & n & " and VID>0")
		
		IF ls1.EOF Then
			Set fso = server.CreateObject("Scripting.Filesystemobject")
				Set newfile = fso.opentextfile(filepatha,2,True)
				newfile.write "<font color=red>该品牌没有通过审核，如有问题，请与我们联系。</font>"
				Set newfile = Nothing
			Set fso = Nothing
			Exit Function
		End IF
		
		ur_ppmc = ls1("UR_PPMC")
		pptitle = ls1("UR_TITLE")
		ur_logo = ls1("UR_LOGO")
		jmall = Split(ls1("UR_JMALL"),"$$")
		Dim PicArr
		if ur_logo&"" = "" then
			set ls2 = conn.execute("select Top 1 PICDIR from CFW_USER_COMP_PIC where SID=" & id & " order by TID desc,ID desc")
			if not ls2.eof then
				ur_logo = SerchLogo(ls2(0),"0")
			else
				ur_logo = CFW_WebUrl&"com/images/no.JPG"
			end if
			ls2.close
			set ls2 = nothing
		end if
		dim flashpic,fpic1,fpic2
		Set ls2 = conn.Execute("select Top 8 PICDIR from CFW_USER_COMP_PIC where SID=" & id & " and (TID<2 or TID is null) order by TID desc,ID desc")
		if not ls2.eof then
			PicArr = "<table width=""603"" border=""0"" cellspacing=""0"" cellpadding=""0""><tr>"
			PicArr = PicArr & "<td height=""32"" background=""../images/ti3-topbg.gif""><table width=""100%"" border=""0"" cellpadding=""0"" cellspacing=""0""><tr><td class=""ti3"">&nbsp;图片展示</td></tr></table></td>"
			PicArr = PicArr & "</tr></table>"
			PicArr = PicArr & "<div id=demo style=""BACKGROUND: #ffffff; OVERFLOW: hidden; WIDTH: 600px; COLOR: #ffffff; HEIGHT: 103px"">"
			PicArr = PicArr & "<table cellPadding=0 align=center border=0 cellspace=0><tr><td id=demo1 vAlign=top>"
			PicArr = PicArr & "<table width=""100%"" cellPadding=0 border=0 cellspace=0><tr>"
			i = 0
			do while not ls2.eof
			PicArr = PicArr & "<td><table align=center><tr><td valign=middle class=b0><a href=""javascript:"" onclick=""javascript:winopen(0,'?v=" & Server.URLEncode(ls2(0)) & "&n=" & Server.URLEncode(ls1("UR_PPMC")) & "')""><img src=" & SerchLogo(ls2(0),"0") & " border=0></a></td></tr></table></td>"
				if i < 4 then
					fpic1 = fpic1 & ls2(0) & "|"
					fpic2 = fpic2 & ls2(0) & "|"
				end if
				i = i + 1
				ls2.movenext
			loop
			PicArr = PicArr & "</tr></table></td>"
			PicArr = PicArr & "<td id=demo2 vAlign=top></td></tr></table>"
			PicArr = PicArr & "<script>" & vbNewLine
			PicArr = PicArr & "var speed=30" & vbNewLine
			PicArr = PicArr & "demo2.innerHTML=demo1.innerHTML" & vbNewLine
			PicArr = PicArr & "function Marquee()" & vbNewLine
			PicArr = PicArr & "{" & vbNewLine
			PicArr = PicArr & "	if(demo2.offsetWidth-demo.scrollLeft<=0) {demo.scrollLeft-=demo1.offsetWidth}" & vbNewLine
			PicArr = PicArr & "	else{demo.scrollLeft++}" & vbNewLine
			PicArr = PicArr & "}" & vbNewLine
			PicArr = PicArr & "var MyMar=setInterval(Marquee,speed)" & vbNewLine
			PicArr = PicArr & "demo.onmouseover=function() {clearInterval(MyMar)}" & vbNewLine
			PicArr = PicArr & "demo.onmouseout=function() {MyMar=setInterval(Marquee,speed)}" & vbNewLine
			PicArr = PicArr & "</script>"
			PicArr = PicArr & "</div>"
			fpic1 = left(fpic1,len(fpic1)-1)
			fpic2 = left(fpic2,len(fpic2)-1)
			'fpic1 = fpic2
		else
			PicArr = ""
		end if
		ls2.Close
		Set ls2 = Nothing
		
		flashpic = "pics="&fpic1&"&links="&fpic2
		Dim NewsLists
		Set ls2 = conn.Execute("select top 4 ID,TITLE from CFW_USER_COMP_NEWS where SID=" & id & " order by UPTIME desc")
		Do While Not ls2.EOF
			NewsLists = NewsLists & "<tr><td><LI><a href=""javascript:"" onclick=""javascript:winopen(1,'" & id & "_" & ls2(0) & ".htm')"">" & Strleft(ls2(1),30) & "</a></td></tr>"
			ls2.MoveNext
		Loop
		ls2.Close
		Set ls2 = Nothing
		bg1 = "#F6F6F6"
		bg2 = "#D4D4D4"	
		bg11 = "#F6F6F6"
		bg22 = "#D4D4D4"	
		conv2select01 = Conv2Select(0,1)
		compt2select00 = compt2select(0,0)
		conv2selectsid = Conv2Select(ls1("SID"),2)
		'comp2stringsid = Comp2String(15,ls1("SID"),0)
		qyjj = Replace(Replace(chkBadWords(Ubb_code(ls1("UR_QYJJ"))) & "","\" & VbCrLf,"\\" & VbCrLf & VbCrLf),"'","''")
		tzje = ls1("UR_TZJE")
		tzje = replace(tzje,"-"," - ")
		'Comp2StringLaid = Comp2String(15,n,1)
		conv2selectsid2 = Conv2Select(ls1("SID"),2)
		comp2selectxid = Comp2Select(ls1("XID"),1)
		ppmce = ls1("UR_PPMCE")
		gsmc = ls1("UR_GSMC")
		gsmce = ls1("UR_GSMCE")
		cltime = ls1("UR_CLTIME")
		txtime = ls1("UR_TXTIME")
		mdnum = ls1("UR_MDNUM")
		jmnum = ls1("UR_JMNUM")
		zczb = ls1("UR_ZCZB")
		nyye = ls1("UR_NYYE")
		jmdq = ls1("UR_JMQY")
		jbtse = ls1("UR_JBTSE")
		jycp = ls1("UR_JYCP")&""
		jmall0 = jmall(0)
		jmall1 = jmall(1)
		jmall2 = jmall(2)
		jmall3 = jmall(3)
		jmall4 = jmall(4)
		jmall5 = jmall(5)
		jmall6 = jmall(6)
		hblid = CompHbl2Select(ls1("UR_HBLID"),1)
		hbzqid = CompHbzq2Select(ls1("UR_HBZQID"),1)
		jyms = CompJyms2Int(ls1("UR_JYMS"),1)
		fzms = CompFzms2Int(ls1("UR_FZMS"),1)
		tzrq = CompTzrq2Int(ls1("UR_TZRQ"),1)
		gsdzs = ls1("UR_GSADD")
		ur_ppfyd = ls1("UR_PPFYD")
		Keywords =ur_ppmc&" "&ur_ppmc&"招商加盟 "&ur_ppmc&"加盟 "&ur_ppmc&"连锁 "&ur_ppmc&"代理 "&ur_ppmc&"防骗子、骗术"
		Description =ur_ppmc&"全国招商 加盟 代理 连锁  行业:"&conv2selectsid2&" 经营产品:"&jycp&" 投资金额:"&tzje&" 加盟金:"&jmall2&" 经营模式:"&jyms&" 谨防假冒、骗子"
		
		if ls1("UR_POST")&"" <> "" then gsdzs = gsdzs & "(" & ls1("UR_POST") & ")"
		tel = ls1("UR_TEL")	      
           
           
		if ls1("VID") <> 5 then	
		
		strcontent1 = strcontent1&"<br />" & vbNewLine
strcontent1 = strcontent1&"<TABLE  class=border-ff7e00 cellSpacing=0 cellPadding=0 width=""100%"" border=0>" & vbNewLine
strcontent1 = strcontent1&"<tr height=25><td  style=""BACKGROUND:#FFA22A;""  colspan=3  class=yn-fz14 > &nbsp;&nbsp;<strong><font color=white>联系方式</font></strong></td></tr>" & vbNewLine
strcontent1 = strcontent1&"<tr height=10><td colspan=3></td></tr>" & vbNewLine
strcontent1 = strcontent1&"<tr>" & vbNewLine
strcontent1 = strcontent1&"<td width=15></td>" & vbNewLine
strcontent1 = strcontent1&"<td align=center>" & vbNewLine
strcontent1 = strcontent1&"<table width=100%  cellSpacing=0 cellPadding=0 border=0>" & vbNewLine
 
 strcontent1 = strcontent1&"<tr>" & vbNewLine
 strcontent1 = strcontent1&"<td width=18%  class=""comInfo"" align=right>公司名称：&nbsp;&nbsp;</td>" & vbNewLine
 strcontent1 = strcontent1&"<td width=32%  class=""comInfo"" align=left >"&gsmc&"</td>" & vbNewLine
  strcontent1 = strcontent1&"<td  width=18%  class=""comInfo"" align=right> 电子信箱：&nbsp;&nbsp;</td>" & vbNewLine
 strcontent1 = strcontent1&"<td  width=32% class=""comInfo""  align=left >"&ls1("UR_MAIL")&"</td>" & vbNewLine
 
 strcontent1 = strcontent1&"</tr>" & vbNewLine
  strcontent1 = strcontent1&"<tr>" & vbNewLine
 strcontent1 = strcontent1&"<td  width=18%   class=""comInfo"" align=right>联系电话：&nbsp;&nbsp;</td>" & vbNewLine
 strcontent1 = strcontent1&"<td width=32%  class=""comInfo"" align=left >"&tel&"</td>" & vbNewLine
 strcontent1 = strcontent1&"<td  width=18%  class=""comInfo"" align=right>传真号码：&nbsp;&nbsp;</td>" & vbNewLine
 strcontent1 = strcontent1&"<td  width=32% class=""comInfo""  align=left >"&ls1("UR_FAX")&"</td>" & vbNewLine
 strcontent1 = strcontent1&"</tr>"& vbNewLine
 

  strcontent1 = strcontent1&" <tr>" & vbNewLine
  strcontent1 = strcontent1&"<td  width=18%   class=""comInfo"" align=right>公司网址：&nbsp;&nbsp;</td>" & vbNewLine
 strcontent1 = strcontent1&"<td  colspan=3  class=""comInfo"" align=left >"&ls1("UR_GSURL")&"</td>" & vbNewLine
 
' strcontent1 = strcontent1&"<td  width=18%   class=""comInfo"" align=right>联 系 人：&nbsp;&nbsp;</td>" & vbNewLine
 'strcontent1 = strcontent1&"<td  colspan=3  class=""comInfo"" align=left >"&StrLeft(ls1("UR_LXR"),18)&"</td>" & vbNewLine

 strcontent1 = strcontent1&"</tr>"
 strcontent1 = strcontent1&" <tr>" & vbNewLine
  strcontent1 = strcontent1&"<td  width=18%   class=""comInfo"" align=right>公司地址：&nbsp;&nbsp;</td>" & vbNewLine
 strcontent1 = strcontent1&"<td  colspan=3  class=""comInfo"" align=left >"&gsdzs&"</td>" & vbNewLine
 strcontent1 = strcontent1&"</tr>"
 strcontent1 = strcontent1&"</table></td><td width=15></td></tr><tr height=10><td colspan=3></td></tr></TABLE>"    & vbNewLine      
           
	
		end if
		

		
		dim clie_name
		clie_name = ""
		if ls1("AID") > 0 then
			set ls2 = conn.execute("select Master_WebName from SALES_CLIE_AGENT where Master_ID=(select top 1 AID from SALES_CLIE_REG where CID=" & n & ")")
			if not ls2.eof then clie_name = "页面责任人:" & ls2(0)
			ls2.close
			set ls2 = nothing
		end if
		
		
		dim JingYJQ		
		JingYJQ = NewsListT_zh2("","<LI>","","</LI>","",16,40,0,"经营技巧",CFW_NewID)		
		set fso = server.CreateObject("scripting.filesystemobject")
		set sourcefile = fso.opentextfile(server.MapPath("..\com\skins\0.htm"),1)          
		sourcetext = sourcefile.readall
		sourcefile.close
		set sourcefile = nothing
		dim XiangMTJ,html_ads
		
		Set rs_ads = conn.Execute("select SID,HTML from CFW_ADS where sid=2035")
	    if not rs_ads.eof then
		    html_ads = rs_ads(1)
	    else
		    html_ads = ""
	    end if
    	
	    XiangMTJ = "<div id=""ads2035"">"&html_ads&"</div>"	
		
		sourcetext = replace(sourcetext,"{$id$}",n)
		sourcetext = replace(sourcetext,"{$ur_ppmc$}",ur_ppmc)
		sourcetext = replace(sourcetext,"{$pp_title$}",pptitle)
		sourcetext = replace(sourcetext,"{$ur_logo$}",ur_logo)
		sourcetext = replace(sourcetext,"{$Conv2Select01$}",Conv2Select01)
		sourcetext = replace(sourcetext," {$CompT2Select00$}",CompT2Select00)
		sourcetext = replace(sourcetext,"{$Conv2Selectsid$}",Conv2Selectsid)
		'sourcetext = replace(sourcetext,"{$comp2stringsid$}",comp2stringsid)
		sourcetext = replace(sourcetext,"{$tzje$}",tzje)
		
		
		'sourcetext = replace(sourcetext,"{$Comp2StringLaid$}",Comp2StringLaid)
		sourcetext = replace(sourcetext,"{$conv2selectsid2$}",conv2selectsid2)
		sourcetext = replace(sourcetext,"{$comp2selectxid$}",comp2selectxid)
		
		'sourcetext = replace(sourcetext,"{$PPMCE$}",PPMCE)
		
		sourcetext = replace(sourcetext,"{$gsmc$}",gsmc)
		
		'sourcetext = replace(sourcetext,"{$gsmce$}",gsmce)
		
		sourcetext = replace(sourcetext,"{$strcontent1$}",strcontent1)
		sourcetext = replace(sourcetext,"{$strcontent2$}",strcontent2)
		sourcetext = replace(sourcetext,"{$strcontent3$}",strcontent3)
		
		sourcetext = replace(sourcetext,"{$cltime$}",cltime)
		
		sourcetext = replace(sourcetext,"{$txtime$}",txtime)
		sourcetext = replace(sourcetext,"{$mdnum$}",mdnum)
		sourcetext = replace(sourcetext,"{$jmnum$}",jmnum)
		sourcetext = replace(sourcetext,"{$zczb$}",zczb)
		sourcetext = replace(sourcetext,"{$nyye$}",nyye)
		sourcetext = replace(sourcetext,"{$jmdq$}",jmdq)
		
		sourcetext = replace(sourcetext,"{$jmnum$}",jmnum)
		sourcetext = replace(sourcetext,"{$flashpic$}",flashpic)
		sourcetext = replace(sourcetext,"{$picarr$}",picarr)
		sourcetext = replace(sourcetext,"{$qyjj$}",qyjj)
		sourcetext = replace(sourcetext,"{$jbtse$}",jbtse)
		sourcetext = replace(sourcetext,"{$hblid$}",hblid)
		sourcetext = replace(sourcetext,"{$hbzqid$}",hbzqid)
		sourcetext = replace(sourcetext,"{$jyms$}",jyms)
		sourcetext = replace(sourcetext,"{$fzms$}",fzms)
		sourcetext = replace(sourcetext,"{$tzrq$}",tzrq)
		sourcetext = replace(sourcetext,"{$ur_ppfyd$}",ur_ppfyd)
		
		sourcetext = replace(sourcetext,"{$jycp$}",jycp)
		sourcetext = replace(sourcetext,"{$bg1$}",bg1)
		sourcetext = replace(sourcetext,"{$bg2$}",bg2)
		sourcetext = replace(sourcetext,"{$bg11$}",bg11)
		sourcetext = replace(sourcetext,"{$bg22$}",bg22)
		sourcetext = replace(sourcetext,"{$jmall0$}",jmall0)
		sourcetext = replace(sourcetext,"{$jmall1$}",jmall1)
		sourcetext = replace(sourcetext,"{$jmall2$}",jmall2)
		sourcetext = replace(sourcetext,"{$jmall3$}",jmall3)
		sourcetext = replace(sourcetext,"{$jmall4$}",jmall4)
		sourcetext = replace(sourcetext,"{$jmall5$}",jmall5)
		sourcetext = replace(sourcetext,"{$jmall6$}",jmall6)
		sourcetext = replace(sourcetext,"{$clie_name$}",clie_name)
		sourcetext = replace(sourcetext,"{$Keywords$}",Keywords)
		sourcetext = replace(sourcetext,"{$Description$}",Description)
		sourcetext = Replace(Sourcetext,"{$CFW_WebUrl$}",CFW_WebUrl)
		sourcetext = Replace(Sourcetext,"{$JingYJQ$}",JingYJQ)
		sourcetext = Replace(Sourcetext,"{$XiangMTJ$}",XiangMTJ)
	
		set newfile = fso.opentextfile(filepatha,2,true)
			newfile.write sourcetext
			newfile.close
		set newfile = nothing
		set fso = nothing 
			
	else
		set fso = server.CreateObject("Scripting.FileSystemObject")
		If fso.FileExists(filepatha)  then fso.deletefile(filepatha)
		set fso = nothing
	end if	

End Function

Function Uptop(n,filepath,m)
	On Error Resume Next
	if m = 0 then
		Set fso = Server.CreateObject("Scripting.FileSystemObject")
		Set sourceFile = fso.OpenTextFile(Server.MapPath("..\CompTj\stat.htm"),1)
			sourceText = sourceFile.ReadAll
			sourceFile.Close
		Set sourceFile = Nothing
		sourceText = replace(sourceText,"{$id$}",n)
		newFileName = FilePath
		Set newFile = fso.OpenTextFile(newFileName,2,True)
			newFile.Write sourceText
			newFile.Close
		Set newFile = Nothing
		Set fso = Nothing		
	Else
		set fso = server.createobject("Scripting.FileSystemObject")	
		If fso.FileExists(filepath) then fso.deletefile(filepath)
		set fso = nothing
	End IF
End Function

Function CompVID2Graph(G_Arr,G_0,G_1,G_2,G_3)
	Dim dyfwsum,arrnum,dtfw,imgh
	Dim max,hn
	Dim OptArrs
	IF Not IsArray(G_Arr) Then Exit Function
	OptArrs = "<table cellspacing=0 cellpadding=0 border=0><tr><td width=25 height=15></td><td>" & G_0 & "</td></tr></table>"
	dyfwsum = 0
	arrnum = Ubound(G_Arr,2)
	max = 0
	for i = 0 to arrnum
		dyfwsum = dyfwsum + G_Arr(0,i)
		If G_Arr(0,i) > G_Arr(0,max) Then max = i
	next
	for i = 0 to 3
		hn = G_Arr(0,max)
		hn = hn + i
		if hn mod 4 = 0 then exit for
	next
	OptArrs = OptArrs & "<table cellspacing=0 cellpadding=0 border=0><tr><td valign=bottom>" & _
	"<table cellspacing=0 cellpadding=0 width=25 height=115 border=0><tr><td height=15 class=t2v></td></tr>" & _
	"<tr><td height=25 class=t2v>" & hn & "</td></tr>" & _
	"<tr><td height=25 class=t2v>" & hn*0.75 & "</td></tr>" & _
	"<tr><td height=25 class=t2v>" & hn*0.5 & "</td></tr>" & _
	"<tr><td height=25 class=t2v>" & hn*0.25 & "</td></tr></table></td>"
	for i = 0 to arrnum
		dtfw = G_Arr(0,i)
		OptArrs = OptArrs & "<td valign=bottom background="&CFW_WebUrl&"CompTj/images/bg.gif style=""background-position: bottom;""><img style=""background-color:#0000FF; width:11; height:" & int(dtfw*100/hn) & ";"" title=""" & G_1 & "" & G_Arr(1,i) & vbCrLf & G_2 & dtfw & vbCrLf & G_3 & FormatNumber(dtfw*100/dyfwsum,2) & "%""></td>"
	next
	OptArrs = OptArrs & "<td width=25></td></tr><tr valign=top><td height=15></td>"
	for i = 0 to arrnum
		OptArrs = OptArrs & "<td><div align=center class=t2>" & G_Arr(1,i) & "</div></td>"
	next
	OptArrs = OptArrs & "<td width=25></td></tr></table>"
	CompVID2Graph = OptArrs
End Function

Function Up_SerchPage(sid,filepath,fp1,k)
	Dim fso,sourceFile,sourceText,newFileName,newFile,newFileFolderName
	IF Not IsNum(sid) Then
		sid = 0
	End IF
	IF Not IsNum(k) Then
		response.Write"<li>参数传递错误，更新失败"
		Exit Function
	Else
		k = cint(k)	
	End IF
	if sid = 0 then
		title = "餐饮品牌加盟网――品牌招商加盟（项目查询）"
	Else
		title = Conv2Select(sid,2) & "加盟招商项目权威媒体――餐饮品牌加盟网"
	End if
	dim shijian,title,strtable,strtables
	dim PathTrue
	shijian = now()
	dim strtable1,strtables1
	strtable = ""
	strtables = ""
	strtable1 = ""
	strtables1 = ""
	if sid = 0 then
		sql = "select ID,NID,SID,TID,UR_LOGO,UR_PPMC,UR_TITLE,UR_PPFYD,UR_CLTIME,UR_MDNUM,UR_JYCP,UR_JBTSE,UR_HBLID,UR_HBZQID,UR_JMALL,UR_JYMS,UR_FZMS,UR_TZRQ from CFW_USER_COMP where VID in (1,2,3,4,5,7) order by YID desc,VID desc,ID desc"
	else
		sql = "select ID,NID,SID,TID,UR_LOGO,UR_PPMC,UR_TITLE,UR_PPFYD,UR_CLTIME,UR_MDNUM,UR_JYCP,UR_JBTSE,UR_HBLID,UR_HBZQID,UR_JMALL,UR_JYMS,UR_FZMS,UR_TZRQ from CFW_USER_COMP where SID=" & sid & " and VID in (1,2,3,4,5,7) order by YID desc,VID desc,ID desc"
	end if
	Set ls = Server.CreateObject("ADODB.Recordset")
	ls.Open sql,conn,1,1
	If ls.EOF and ls.BOF Then
		strtables = "<LI>暂时没有推荐项目！"
		strtables1 = "<LI>暂时没有推荐项目！"
		ls.Close
		Set ls = Nothing
		response.Write"<script>alert('页面更新失败，请联系技术部！');opener=null;window.close();</script>"
		Exit Function
	End If
	Dim Page,Page_Size,Page_Count,PCount
	Page = k
	IF  Not IsNum(Page) or Cstr(Page) = "0" Then
		Page = 1
	Else
		Page = Abs(Page)
	End IF
	Page_Size = 22
	Page_Count = 0
	ls.PageSize = Page_Size
	PCount = ls.PageCount
	IF Page > PCount Then Page = PCount
	ls.AbsolutePage = Page
	dim compic,CompLogo,jmall,hblid,hbzqid
	While (Not ls.EOF) and (Not Page_Count = Page_Size)
		CompLogo = ls("UR_LOGO")
		if CompLogo&"" = "" then
			set ls1 = conn.execute("select top 1 PICDIR from CFW_USER_COMP_PIC where SID="&ls("ID")&" order by TID desc")
			if not ls1.eof then
				compic = ls1(0)
			else
				compic = ""
			end if
			ls1.close
			set ls1 = nothing
			CompLogo = SerchLogo(compic&"","0")
		end if
		CompUrl = Comp2Skin(ls("ID"),ls("NID"))
		'CompTitle = CompTitle2Select(ls("TID"),1)
		CompTitle = ls("UR_TITLE")
		dyzs = conn.execute("select sum(CAST(ROUND(ZID,2) AS int)) from CFW_USER_COMP_VIEW where NID="&ls("ID")&" and DateDiff(m,VIEWTIME,GETDATE())=0")(0)
		if not isnum(dyzs) then dyzs = 0
		if dyzs < 0 then dyzs = 0
		hblid = CompHbl2Select(ls("UR_HBLID"),1)
		hbzqid = CompHbzq2Select(ls("UR_HBZQID"),1)
		jmall = split(ls("UR_JMALL"),"$$")
		if bgcolor="" then
			bgcolor=" bgcolor=#f4f4f6"
		else
			bgcolor=""
		end if
		
		
		''''''''''''''''''''''
		strtable="<tr"&bgcolor&">"
		
		  strtable=strtable&"<td width=""25"" align=""right""></td>" & vbNewLine
          strtable=strtable&"<td width=""20"" height=""120"" align=""center"">" & vbNewLine
            strtable=strtable&"</td>" & vbNewLine
          strtable=strtable&"<td  width=500><table border=""0"" cellspacing=""0"" cellpadding=""0"">" & vbNewLine
              strtable=strtable&"<tr>" & vbNewLine
                strtable=strtable&"<td height=""30""><a href="""&CFW_WebUrl&"com/c1/"&ls("ID")&".htm"" target=_blank class=""a15"">"&CompTitle&"</a>　</td>" & vbNewLine
              strtable=strtable&"</tr>" & vbNewLine
              strtable=strtable&"<tr>" & vbNewLine
               strtable=strtable&"<td style=""word-break:break-all""><a href="""&CFW_WebUrl&"com/c1/"&ls("ID")&".htm"" target=_blank class=""a14""><span style=""color:#000000"">品牌:"&ls("UR_PPMC")&", 经营产品:"&ShowNull(ls("UR_JYCP"),0)&" ,加盟金:"&ShowNull(jmall(2),0)&" 保证金:"&ShowNull(jmall(3),0)&" ,发源地:"&ShowNull(ls("UR_PPFYD"),0)&" ,成立时间:"&ShowNull(ls("UR_CLTIME"),0)&" ,营业条件要求:"&ShowNull(jmall(0),0)&"</span></a></td>" & vbNewLine
              strtable=strtable&"</tr>" & vbNewLine
              strtable=strtable&"<tr>" & vbNewLine
                              
                 strtable=strtable&"<td height=""30"">" & vbNewLine
                strtable=strtable&"<a  href="""&CFW_WebUrl&"com/coms/"&ls("ID")&"/zx.htm""  target=_blank ><img src="""&CFW_WebUrl&"com/sig_img/zixun.gif"" width=""69"" height=""21"" border=""0""  style=""cursor:pointer"" /></a> " & vbNewLine
              strtable=strtable&" </td></tr>" & vbNewLine
            strtable=strtable&"</table></td>" & vbNewLine
               strtable=strtable&"<td  width=30></td>" & vbNewLine
          strtable=strtable&"<td width=""100"" align=""center"">"&Strleft(ls("UR_JBTSE"),20)&"</td>" & vbNewLine
          
          
		
		strtable1=strtable
		
		if page_count = 2 then
			'strtable=strtable&"<tr><td height=""2"" bgcolor=""#FF7E00"" colspan=""9""></td></tr>"
			'strtable1=strtable1&"<tr><td height=""2"" bgcolor=""#FF7E00"" colspan=""9""></td></tr>"
		end if
		strtables=strtables&strtable
		strtables1=strtables1&strtable1
		
		'''''''''''''''''''''
		Page_Count = Page_Count + 1
		ls.MoveNext
	Wend
	ls.close
	set ls = nothing
	strtables=strtables&"<tr><td height=""50"" colspan=""9"" align=""center"">"&SerchPages(PCount,Page,sid)&"</td></tr></td></tr>"
	strtables="<table width=""100%"" border=""0"" cellspacing=""0"" cellpadding=""0""><tr> <td colspan=2></td><td >品牌项目信息</td> <td></td><td align=center >投资金额</td> </tr>  <tr><td height=3  colspan=5 bgcolor=#FF7E00></td></tr>"&strtables&"</table>"
	
	
	strtables1=strtables1&"<tr><td height=""50"" colspan=""9"" align=""center"">"
	if sid = 0 then
		strtables1=strtables1&SerchPages(PCount,Page,"so")
	else
		strtables1=strtables1&SerchPages(PCount,Page,"so/"&sid)
	end if
	strtables1=strtables1&"</td></tr></td></tr>"
	strtables1="<table width=""100%"" border=""0"" cellspacing=""0"" cellpadding=""0""><tr> <td colspan=2></td><td >品牌项目信息</td> <td></td><td align=center >投资金额</td> </tr>  <tr><td height=3  colspan=5 bgcolor=#FF7E00></td></tr>"&strtables1&"</table>"
	Set fso = Server.CreateObject("Scripting.FileSystemObject")
	
	Set sourceFile = fso.OpenTextFile(Server.MapPath("..\com\item.htm"),1)
		sourceText = sourceFile.ReadAll
		sourceFile.Close
	Set sourceFile = Nothing
	sourceText = replace(sourceText,"{$strtables$}",strtables)
	sourceText = replace(sourceText,"{$shijian$}",shijian)
	sourceText = replace(sourceText,"{$title$}",title)
	sourceText = replace(sourceText,"{$CFW_WebUrl$}",CFW_WebUrl)
	newFileName = filepath
	Set newFile = fso.OpenTextFile(newFileName,2,True)
		newFile.Write sourceText
		newFile.Close
	Set newFile = Nothing
	if fp1<>"" then
		Set sourceFile = fso.OpenTextFile(Server.MapPath("..\com\so\item.htm"),1)
			sourceText = sourceFile.ReadAll
			sourceFile.Close
		Set sourceFile = Nothing
		sourceText = replace(sourceText,"{$strtables$}",strtables1)
		sourceText = replace(sourceText,"{$shijian$}",shijian)
		sourceText = replace(sourceText,"{$title$}",title)
		sourceText = replace(sourceText,"{$CFW_WebUrl$}",CFW_WebUrl)
		newFileName = fp1
		Set newFile = fso.OpenTextFile(newFileName,2,True)
			newFile.Write sourceText
			newFile.Close
		Set newFile = Nothing
	end if
	Set fso = nothing
	response.Write k&"|<br>"
End Function

Function Up_SerchPage2(sid,subid,filepath,fp1,k,tzje,jetype)
	Dim fso,sourceFile,sourceText,newFileName,newFile,newFileFolderName
	IF Not IsNum(sid) Then
		sid = 0
	End IF
	IF Not IsNum(k) Then
		response.Write"<li>参数传递错误，更新失败"
		Exit Function
	Else
		k = cint(k)	
	End IF
	
	if sid = 0 then
		title = "餐饮品牌加盟网――品牌招商加盟（项目查询）"
	Else
		title = Conv2Select(sid,2) & "加盟招商项目权威媒体――餐饮品牌加盟网"
	End if
	
	
	dim shijian,title,strtable,strtables
	dim PathTrue
	shijian = now()
	dim strtable1,strtables1
	strtable = ""
	strtables = ""
	strtable1 = ""
	strtables1 = ""
	if sid = 0 then
		sql = "select ID,NID,SID,TID,UR_LOGO,UR_PPMC,UR_TITLE,UR_PPFYD,UR_CLTIME,UR_MDNUM,UR_JYCP,UR_JBTSE,UR_HBLID,UR_HBZQID,UR_JMALL,UR_JYMS,UR_FZMS,UR_TZRQ  from CFW_USER_COMP where VID in (1,2,3,4,5,7) order by YID desc,VID desc,ID desc"
	else
	    if subid =0 then
		    sql = "select ID,NID,SID,TID,UR_LOGO,UR_PPMC,UR_TITLE,UR_PPFYD,UR_CLTIME,UR_MDNUM,UR_JYCP,UR_JBTSE,UR_HBLID,UR_HBZQID,UR_JMALL,UR_JYMS,UR_FZMS,UR_TZRQ   from CFW_USER_COMP where ID in (select compid from CFW_CONVTYPE_USERCOMP where sid=" & sid & " group by compid) and UR_TZJE='"&tzje&"' and VID in (1,2,3,4,5,7) order by YID desc,VID desc,ID desc"
	    else
	        sql =  "select ID,NID,SID,TID,UR_LOGO,UR_PPMC,UR_TITLE,UR_PPFYD,UR_CLTIME,UR_MDNUM,UR_JYCP,UR_JBTSE,UR_HBLID,UR_HBZQID,UR_JMALL,UR_JYMS,UR_FZMS,UR_TZRQ   from CFW_USER_COMP where ID in (select compid from CFW_CONVTYPE_USERCOMP where subid=" & subid & " group by compid) and VID in (1,2,3,4,5,7) order by YID desc,VID desc,ID desc"
	    end if
	end if
	Set ls = Server.CreateObject("ADODB.Recordset")
	ls.Open sql,conn,1,1
	If ls.EOF and ls.BOF Then
		strtables = "<LI>暂时没有推荐项目！"
		strtables1 = "<LI>暂时没有推荐项目！"
		ls.Close
		Set ls = Nothing
		response.Write"<script>alert('页面更新失败，请联系技术部！');opener=null;window.close();</script>"
		Exit Function
	End If
	Dim Page,Page_Size,Page_Count,PCount
	Page = k
	IF  Not IsNum(Page) or Cstr(Page) = "0" Then
		Page = 1
	Else
		Page = Abs(Page)
	End IF
	Page_Size = 22
	Page_Count = 0
	ls.PageSize = Page_Size
	PCount = ls.PageCount
	IF Page > PCount Then Page = PCount
	ls.AbsolutePage = Page
	dim compic,CompLogo,jmall,hblid,hbzqid
	While (Not ls.EOF) and (Not Page_Count = Page_Size)
		CompLogo = ls("UR_LOGO")
		if CompLogo&"" = "" then
			set ls1 = conn.execute("select top 1 PICDIR from CFW_USER_COMP_PIC where SID="&ls("ID")&" order by TID desc")
			if not ls1.eof then
				compic = ls1(0)
			else
				compic = ""
			end if
			ls1.close
			set ls1 = nothing
			CompLogo = SerchLogo(compic&"","0")
		end if
		CompUrl = Comp2Skin(ls("ID"),ls("NID"))
		'CompTitle = CompTitle2Select(ls("TID"),1)
		CompTitle = ls("UR_TITLE")
		dyzs = conn.execute("select sum(CAST(ROUND(ZID,2) AS int)) from CFW_USER_COMP_VIEW where NID="&ls("ID")&" and DateDiff(m,VIEWTIME,GETDATE())=0")(0)
		if not isnum(dyzs) then dyzs = 0
		if dyzs < 0 then dyzs = 0
		hblid = CompHbl2Select(ls("UR_HBLID"),1)
		hbzqid = CompHbzq2Select(ls("UR_HBZQID"),1)
		if isnull(ls("UR_JMALL")) then
		    'jmall = Array(10)
		else
		    jmall = split(ls("UR_JMALL"),"$$")
		end if
		
		if bgcolor="" then
			bgcolor=" bgcolor=#F3F8FC"
		else
			bgcolor=""
		end if
		strtable="<tr"&bgcolor&">"
		
		  strtable=strtable&"<td width=""25"" align=""right""></td>" & vbNewLine
          strtable=strtable&"<td width=""20"" height=""120"" align=""center"">" & vbNewLine
            strtable=strtable&"</td>" & vbNewLine
          strtable=strtable&"<td  width=500><table border=""0"" cellspacing=""0"" cellpadding=""0"">" & vbNewLine
              strtable=strtable&"<tr>" & vbNewLine
                strtable=strtable&"<td height=""30""  class=""a15""><a href="""&CFW_WebUrl&"com/c1/"&ls("ID")&".htm"" target=_blank >"&CompTitle&"</a>　</td>" & vbNewLine
              strtable=strtable&"</tr>" & vbNewLine
              strtable=strtable&"<tr>" & vbNewLine
               strtable=strtable&"<td style=""word-break:break-all""><a href="""&CFW_WebUrl&"com/c1/"&ls("ID")&".htm"" target=_blank class=""a14""><span style=""color:#000000"">品牌:"&ls("UR_PPMC")&", 经营产品:"&ShowNull(ls("UR_JYCP"),0)&" ,加盟金:"&ShowNull(jmall(2),0)&" 保证金:"&ShowNull(jmall(3),0)&" ,发源地:"&ShowNull(ls("UR_PPFYD"),0)&" ,成立时间:"&ShowNull(ls("UR_CLTIME"),0)&"  ,营业条件要求:"&ShowNull(jmall(0),0)&"</span></a></td>" & vbNewLine
              strtable=strtable&"</tr>" & vbNewLine
              strtable=strtable&"<tr>" & vbNewLine
                              
                 strtable=strtable&"<td height=""30"">" & vbNewLine
                strtable=strtable&"<a  href="""&CFW_WebUrl&"com/coms/"&ls("ID")&"/zx.htm""  target=_blank ><img src="""&CFW_WebUrl&"com/sig_img/zixun.gif"" width=""69"" height=""21"" border=""0""  style=""cursor:pointer"" /></a> " & vbNewLine
              strtable=strtable&" </td></tr>" & vbNewLine
            strtable=strtable&"</table></td>" & vbNewLine
               strtable=strtable&"<td  width=30></td>" & vbNewLine
          strtable=strtable&"<td width=""100"" align=""center"">"&Strleft(ls("UR_JBTSE"),20)&"</td>" & vbNewLine
          
          
		
		strtable1=strtable
		
		if page_count = 2 then
			'strtable=strtable&"<tr><td height=""2"" bgcolor=""#FF7E00"" colspan=""9""></td></tr>"
			'strtable1=strtable1&"<tr><td height=""2"" bgcolor=""#FF7E00"" colspan=""9""></td></tr>"
		end if
		strtables=strtables&strtable
		strtables1=strtables1&strtable1
		Page_Count = Page_Count + 1
		ls.MoveNext
	Wend
	ls.close
	set ls = nothing
	strtables=strtables&"<tr><td height=""50"" colspan=""9"" align=""center"">"&SerchPages2(PCount,Page,sid,subid,jetype)&"</td></tr></td></tr>"
	strtables="<table width=""100%"" border=""0"" cellspacing=""0"" cellpadding=""0""><tr> <td colspan=2></td><td >品牌项目信息</td> <td></td><td align=center >投资金额</td> </tr>  <tr><td height=3  colspan=5 bgcolor=#FF7E00></td></tr>"&strtables&"</table>"
	
	
	'strtables1=strtables1&"<tr><td height=""50"" colspan=""9"" align=""center"">"
	
	'if sid = 0 then
		'strtables1=strtables1&SerchPages2(PCount,Page,"so",subid)
	'else
		'strtables1=strtables1&SerchPages2(PCount,Page,"so/"&sid,subid)
	'end if
	'strtables1=strtables1&"</td></tr></td></tr>"
	'strtables1="<table width=""100%"" border=""0"" cellspacing=""0"" cellpadding=""0""><tr> <td colspan=2></td><td >品牌项目信息</td> <td></td><td align=center >投资金额</td> </tr>  <tr><td height=3  colspan=5 bgcolor=#FF7E00></td></tr>"&strtables1&"</table>"
	
	
	Set fso = Server.CreateObject("Scripting.FileSystemObject")
	
	Set sourceFile = fso.OpenTextFile(Server.MapPath("..\com\item.htm"),1)
		sourceText = sourceFile.ReadAll
		sourceFile.Close
	Set sourceFile = Nothing
	
	'静态页行业下拉框初始化
	dim tzjevalue
    tzjevalue =tzje   
	sourceText = replace(sourceText,"{$tzjevalue$}",tzjevalue)
	sourceText = replace(sourceText,"{$CFW_HYID_Abc$}",AbcToStr(CFW_HYID))
	
	sourceText = replace(sourceText,"{$strtables$}",strtables)
	sourceText = replace(sourceText,"{$shijian$}",shijian)
	sourceText = replace(sourceText,"{$title$}",title)
	
		sourceText = replace(sourceText,"{$CFW_WebUrl$}",CFW_WebUrl)
	newFileName = filepath
	Set newFile = fso.OpenTextFile(newFileName,2,True)
		newFile.Write sourceText
		newFile.Close
	Set newFile = Nothing
	'if fp1<>"" then
		'Set sourceFile = fso.OpenTextFile(Server.MapPath("..\com\so\item.htm"),1)
			'sourceText = sourceFile.ReadAll
			'sourceFile.Close
		'Set sourceFile = Nothing
		'sourceText = replace(sourceText,"{$strtables$}",strtables1)
		'sourceText = replace(sourceText,"{$shijian$}",shijian)
		'sourceText = replace(sourceText,"{$title$}",title)
			'sourceText = replace(sourceText,"{$CFW_WebUrl$}",CFW_WebUrl)
		'newFileName = fp1
		'Set newFile = fso.OpenTextFile(newFileName,2,True)
			'newFile.Write sourceText
			'newFile.Close
		'Set newFile = Nothing
	'end if
	Set fso = nothing
End Function
Function SerchPages(PerCount,CurPage,Url_Add)'读模板搜索分页
	Dim URL,strpage
	strpage=""
	IF cstr(Url_Add) = "0" Then
		URL = CFW_WebUrl&"com/"
	Else
		URL = CFW_WebUrl&"com/"&Url_Add&"/"
	End IF
	IF CurPage>PerCount Then CurPage=PerCount
	IF PerCount>1 Then
		IF CurPage>1 Then
			strpage=strpage&"<a href="""&Url&"""><font face=webdings title=首页>9</font></a>"
			IF CurPage = 2 Then
				strpage=strpage&" <a href="""&Url&"""><font face=webdings title=上页>7</font></a> "
			Else
				strpage=strpage&" <a href="""&Url&"_"&CurPage-1&".htm""><font face=webdings title=上页>7</font></a> "
			End IF
		Else
			strpage=strpage&"<font face=webdings color=Gray>9 7</font>"
		End IF
		IF CurPage-4 > 1 Then strpage=strpage& " ..."
		For i=CurPage-4 To CurPage+4
			IF i>=1 and i<=PerCount Then
				IF i = Clng(CurPage) Then
					strpage=strpage&" <font color=red>"&i&"</font>"
				Else
					IF i = 1 Then
						strpage=strpage&" <a href="""&Url&""">"&i&"</a>"
					Else
						strpage=strpage&" <a href="""&Url&"_"&i&".htm"">"&i&"</a>"
					End IF
				End IF
			End IF
		Next
		IF CurPage+4 < PerCount Then strpage=strpage&" ..."
		IF CurPage<PerCount Then
			strpage=strpage&" <a href="""&Url&"_"&CurPage+1&".htm""><font face=webdings title=下页>8</font></a> <a href="""&Url&"_"& PerCount &".htm""><font face=webdings title=尾页>:</font></a>"
		Else
			strpage=strpage&" <font face=webdings color=Gray>8 :</font>"
		End IF
	Else
			strpage=strpage&"<font face=webdings color=Gray>9 7</font> <font color=red>1</font> <font face=webdings color=Gray>8 :</font>"
	End IF
	SerchPages=strpage
End Function	

Function SerchPages2(PerCount,CurPage,sid,subid,jetype)'读模板搜索分页
	Dim URL,strpage
	strpage=""
	'IF cstr(sid) = "0" Then
		'URL = CFW_WebUrl&"com/"
	'Else
	URL = CFW_WebUrl&"com/"&AbcToStr(sid)&"/"
		
	'End IF
	IF CurPage>PerCount Then CurPage=PerCount
	IF PerCount>1 Then
		IF CurPage>1 Then
		    if subid > 0 then
		        strpage=strpage&"<a href="""&Url&subid&"_1.htm"&"""><font face=webdings title=首页>9</font></a>"
		    else
		        strpage=strpage&"<a href="""&Url&jetype&"_1.htm"&"""><font face=webdings title=首页>9</font></a>"
		    end if
			
			IF CurPage = 2 Then
			    if subid > 0 then
			        strpage=strpage&" <a href="""&Url&subid&"_"&CurPage-1&".htm"&"""><font face=webdings title=上页>7</font></a> "
			    else
			        strpage=strpage&" <a href="""&Url&jetype&"_"&CurPage-1&".htm"&"""><font face=webdings title=上页>7</font></a> "
			    end if
				
			Else
			    if subid >0 then
			        strpage=strpage&" <a href="""&Url&subid&"_"&CurPage-1&".htm""><font face=webdings title=上页>7</font></a> "
			    else
				    strpage=strpage&" <a href="""&Url&jetype&"_"&CurPage-1&".htm""><font face=webdings title=上页>7</font></a> "
				end if
			End IF
		Else
			strpage=strpage&"<font face=webdings color=Gray>9 7</font>"
		End IF
		IF CurPage-4 > 1 Then strpage=strpage& " ..."
		For i=CurPage-4 To CurPage+4
			IF i>=1 and i<=PerCount Then
				IF i = Clng(CurPage) Then
					strpage=strpage&" <font color=red>"&i&"</font>"
				Else
					IF i = 1 Then
					    if subid > 0 then
					        strpage=strpage&" <a href="""&Url&subid&"_1.htm"&""">"&i&"</a>"
					    else
					        strpage=strpage&" <a href="""&Url&jetype&"_1.htm"&""">"&i&"</a>"
					    end if
						
					Else
					    if subid >0 then
			                strpage=strpage&" <a href="""&Url&subid&"_"&i&".htm"">"&i&"</a>"
			            else
						    strpage=strpage&" <a href="""&Url&jetype&"_"&i&".htm"">"&i&"</a>"
						end if
					End IF
				End IF
			End IF
		Next
		IF CurPage+4 < PerCount Then strpage=strpage&" ..."
		IF CurPage<PerCount Then
		    if subid >0 then
                strpage=strpage&" <a href="""&Url&subid&"_"&CurPage+1&".htm""><font face=webdings title=下页>8</font></a> <a href="""&Url&subid&"_"& PerCount &".htm""><font face=webdings title=尾页>:</font></a>"
            else
			    strpage=strpage&" <a href="""&Url&jetype&"_"&CurPage+1&".htm""><font face=webdings title=下页>8</font></a> <a href="""&Url&jetype&"_"& PerCount &".htm""><font face=webdings title=尾页>:</font></a>"
		    end if
		Else
			strpage=strpage&" <font face=webdings color=Gray>8 :</font>"
		End IF
	Else
			strpage=strpage&"<font face=webdings color=Gray>9 7</font> <font color=red>1</font> <font face=webdings color=Gray>8 :</font>"
	End IF
	SerchPages2=strpage
End Function

Function get_ads(sid)
   dim html
	Set rs = conn.Execute("select SID,HTML from CFW_ADS where sid="&sid)
	if not rs.eof then
		html = rs(1)
	else
		html = ""
	end if
	
	get_ads = "<div id=""ads" & sid & """>"&html&"</div>"

End Function	
Function AbcToStr(Str)'新闻目录转换
	IF Str = "" Then Exit Function
	AbcToStr = Replace(Str,"0","a")
	AbcToStr = Replace(AbcToStr,"1","b")
	AbcToStr = Replace(AbcToStr,"2","c")
	AbcToStr = Replace(AbcToStr,"3","d")
	AbcToStr = Replace(AbcToStr,"4","e")
	AbcToStr = Replace(AbcToStr,"5","f")
	AbcToStr = Replace(AbcToStr,"6","g")
	AbcToStr = Replace(AbcToStr,"7","h")
	AbcToStr = Replace(AbcToStr,"8","i")
	AbcToStr = Replace(AbcToStr,"9","g")
End Function	

Function NewsListT_zh2(nClass,nLeft,nCenter,nRight,nNewImg,TopNum,LenNum,NewNum,Sname,CFWNewID)
	Dim I
	Dim FunStr,NewsUrl,NewsTime
	I = 0
	'response.Write "select top " & TopNum & " TITLE,CITE,FILENAME,UPTIME from CFW_NEWS where sid = ( select ID from CFW_NEWS_TYPE where   sname='"&Sname&"' and sid='"&CFWNewID&"') order by TID desc,UPTIME desc"
	
	Set ls = conn.Execute("select top " & TopNum & " TITLE,CITE,FILENAME,UPTIME from CFW_NEWS where sid = ( select ID from CFW_NEWS_TYPE where   sname='"&Sname&"' and sid='"&CFWNewID&"') order by TID desc,UPTIME desc")
	
	Do While Not ls.EOF
		NewsUrl = ls(1) & ""
		NewsTime = FormatDateTime(ls(3),1)
		NewsTime = Right(NewsTime,Len(NewsTime)-5)
		
		
		IF I = NewNum Then nNewImg = ""
		IF NewsUrl = "" Then 
		NewsUrl = Replace(LCase(ls(2) & ""),"../",CFW_NEWSUrl)
		else
		NewsUrl = Replace(LCase(ls(2) & ""),"../",CFW_NEWSUrl)
		end if
		
		FunStr = FunStr & nLeft & "<a href=""" & NewsUrl & """"  & nClass & " target=_blank>" & Html2Txt(ls(0),LenNum) & "</a>" & nNewImg & nCenter  & nRight 
		
		ls.MoveNext
		I = I + 1
	Loop
	ls.Close
	Set ls = Nothing
	NewsListT_zh2 = FunStr
End Function

Function Html2Txt(Str,Num)
	IF IsNull(Str) Then Exit Function
	IF Not IsNum(Num) Then Exit Function
	Dim re
	Set re = New RegExp
	re.IgnoreCase = True
	re.Global = True
	IF Num > 0 Then
		IF InStr(Str,"<b><font color=red>")>0 Then
			re.Pattern="<b><font color=red>(.*)</font></b>"
			Str=re.Replace(Str,"$1")
			Str="<b><font color=red>" & StrLeft(Str,Num-3) & "</font></b>"
		ElseIF InStr(Str,"<b>")>0 Then
			Re.Pattern="<b>(.*)</b>"
			Str=re.Replace(Str,"$1")
			Str="<b>" & StrLeft(Str,Num-3) & "</b>"
		ElseIF InStr(Str,"<font color=red>")>0 Then
			Re.Pattern="<font color=red>(.*)</font>"
			Str=re.Replace(Str,"$1")
			Str="<font color=red>" & StrLeft(Str,Num) & "</font>"
		Else
			Str= StrLeft(Str,Num)
		End IF
	Else
		Re.Pattern="(<a.[^>]*>)(.*)</a>"
		Str=re.Replace(Str,"$1<font color=red>$2</font></a>")
	End IF
	Set Re = Nothing
	Html2Txt = Str
End Function
%>