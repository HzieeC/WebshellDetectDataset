
<% Sub BoardLists()%>
<div class="admintitleft">网站分类版块管理</div>
<table class="cssraindemo1" id="table1">
<thead>
<tr>
 <th  width="26">ID</th>
    <th width="172"><font color="#FF0000"><strong>点击栏目名称进入修改</strong></font></th>
    <th width="300">简介</th>
    <th width="100" >分版主</th>
    <th width="32">排序</th>
    <th width="84">操作</th>
</tr>
</thead>
<tbody>
 <%set rs2=server.CreateObject("adodb.recordset")
sql2="select * from "&BoardTable&" where board_father=0 order by board_order desc,board_id desc"
rs2.open sql2,conn,1,1
do while not rs2.eof
%>
  <tr>
    <td height="18"><strong><%=rs2("board_id")%></strong></td>
    <td ><strong><a href="AdminManage.asp?Action=boardedit&boardid=<%=rs2("board_id")%>"><font color="#FF0000"><%=rs2("board_name")%></font></a></strong></td>
    <td ><strong><%=Titleleft(trim(rs2("board_about")),40)%></strong></td>
    <td ><strong><%=trim(rs2("board_admin"))%>&nbsp;</strong></td>
    <td ><strong><a href="AdminManage.asp?Action=boardup&Board_order=<%=rs2("Board_order")%>">↑</a> <a href="AdminManage.asp?Action=boarddown&Board_order=<%=rs2("Board_order")%>">↓</a></strong></td>
    <td ><strong><a href="AdminManage.asp?Action=boarddel&boardid=<%=rs2("board_id")%>">删除</a></strong></td>
  </tr>
  <%set rs=server.CreateObject("adodb.recordset")
sql="select * from "&BoardTable&" where board_father="&rs2("board_id")&" order by board_order desc,board_id desc"
rs.open sql,conn,1,1
do while not rs.eof
%>
  <tr >
    <td height="18">-></td>
    <td >&nbsp;&nbsp; <a href="AdminManage.asp?Action=boardedit&boardid=<%=rs("board_id")%>"><%=rs("board_name")%></a></td>
    <td><%=Titleleft(trim(rs("board_about")),40)%></td>
    <td ><%=trim(rs("board_admin"))%>&nbsp;</td>
    <td ><a href="AdminManage.asp?Action=boardup&Board_order=<%=rs("Board_order")%>">↑</a> <a href="AdminManage.asp?Action=boarddown&Board_order=<%=rs("Board_order")%>">↓</a></td>
    <td ><a href="AdminManage.asp?Action=boarddel&boardid=<%=rs("board_id")%>">删除</a></td>
  </tr>
  <%rs.movenext
	Loop
	rs.close
set rs=Nothing
%>
  <%rs2.movenext
	Loop
	rs2.close
set rs2=Nothing
%>

</tbody>
</table>
<!-- 下面是对分类进行修改或者添加的功能 -->
<BR>
<%
boardid=checkNum(Request.QueryString("boardid"))
If boardid<>0 Then 
	set rs=server.CreateObject("adodb.recordset")
	sql="select * from "&BoardTable&" where board_id="&boardid
		rs.open sql,conn,1,3
			board_name=rs("board_name")
			board_about=rs("board_about")
			board_admin=rs("board_admin")
			board_photo=rs("board_photo")
			board_father=rs("board_father")
			board_qxs=rs("board_qxs")
		rs.close
	set rs=Nothing
	setcz="修改网站栏目分类"
	board_act="修改提交"
Else
	setcz="添加网站栏目分类"
	board_order="100"
	board_act="添加提交"
	board_father=0
End If 
%>
<table width="820" border="1" align="center" cellpadding="3" cellspacing="0" bordercolorlight="#cecece" bordercolordark="#FFFFFF" bgcolor="#C5D5E4"  style="font-size:12px; letter-spacing:1px;">
  <tr >
    <td  class="admintopbg" align="center"><B><%=setcz%></B></td>
  </tr>
  <form name="form12" method="post" action="AdminManage.asp?Action=boardsave">
    <tr class="zd_td">
      <td bgcolor="#DFDFDF"> 分类名称：
        <input type="text" name="board_name" size="21" maxlength="30" value="<%=board_name%>">
        所属分类：
        <select name='board_father'>
          <%
	  	response.write "<option value=""0"">根分类</option>"
	If Not IsArray(Arr_Category) Then GetBoardCache()
	If IsArray(Arr_Category) Then
		For i=0 To Ubound(Arr_Category,2)
			If Int(Arr_Category(5,i))=0 Then
				If Int(Arr_Category(1,i))=Int(board_father) Then
					nn=" selected"
				Else
					nn=""
				End If
			response.write "<option value="""&Arr_Category(1,i)&""""&nn&">"&Arr_Category(0,i)&"</option>"
			End If 
		Next
	End If 
	  %>
        </select>
        发贴权限：
        <select name="board_qxs">
          <option value="0" <%if board_qxs="0" then response.Write "selected=""selected""" %>>所有会员</option>
          <option value="9" <%if board_qxs="9" then response.Write "selected=""selected""" %>>管理员</option>
          <option value="1" <%if board_qxs="1" then response.Write "selected=""selected""" %>>版主</option>
        </select></td>
    </tr>
    <tr bgcolor="#F3F3F3" >
      <td> 分类广告：
        <textarea rows="5" name="board_photo" cols="70" class="an"><%=board_photo%></textarea>
        *120字以内（支持Html）</td>
    </tr>
    <tr >
      <td bgcolor="#DFDFDF"> 版主：
        <input type="text" name="board_admin" size="30" maxlength="100" value="<%=board_admin%>">
        多位版主请用|分割，最后一位后面不要输入|。←<a href="javascript:" onClick="document.form12.board_admin.value+='|'">点此插入|符号</a>*版主继承到子分类</td>
    </tr>
    <tr class="zd_td">
      <td bgcolor="#F3F3F3"> 分类说明：
        <textarea rows="5" name="Board_about" cols="70" class="an"><%=board_about%></textarea>
        *120字以内（支持Html）
        <input type="hidden" name="board_id" value="<%=boardid%>"></td>
    </tr>
    <tr >
      <td  class="admintopbg" align="center"><input type="submit" name="Submit3" value="<%=board_act%>" class="an"></td>
    </tr>
  </form>
</table>
<%End Sub
'-----------------------定义修改分类提交
Sub BoardSave()
Board_id=Request.Form("Board_id")
Board_name=Replace(CStr(Request.Form("Board_name")),"|","") '分类中禁止使用"|"
Board_name=Replace(Board_name,"!","") '分类中禁止使用"!"
Board_About=Request.Form("Board_about")
board_admin=Request.Form("board_admin")
board_photo=Request.Form("board_photo")
board_qxs=Request.Form("board_qxs")
board_father=checkNum(Request.Form("board_father"))


If Board_id="0" Then Board_id=""
If Board_name="" Or Len(Board_name)>100 Then response.write backmsg("分类名称太短或者太长","")
If Board_About="" Or Len(Board_About)>1000 Then response.write backmsg("分类说明太短或者太长","")
If board_father="" Then response.write backmsg("父分类参数错误","")

Set rs = Server.CreateObject("ADODB.Recordset")
'判断是修改还是添加
If Board_id="" Then'如果是添加
		'这里首先要读取最大排序数字，为的是给新添加的排序字段有数据输入。
		Set Rs77=Conn.Execute("SELECT Max(board_order) FROM "& BoardTable &"")
			If Rs77.EOF Or Rs77.BOF Then 
				board_order=1
			Else
				board_order=Rs77(0)+1
			End If
		If IsNull(board_order) Then board_order=1
		'读取排序号结束。
acts="添加"
sql = "SELECT * FROM "&BoardTable&" where (Board_id is null)" 
rs.OPEN sql,Conn,1,3
rs.addnew
rs("board_order")=board_order
Else
acts="修改"
sql = "SELECT * FROM "&BoardTable&" where Board_id="&Board_id 
rs.OPEN sql,Conn,1,3
End If 
rs("Board_name")=Board_name
rs("Board_About")=Board_About
rs("board_photo")=board_photo
rs("board_admin")=board_admin
rs("board_father")=board_father
rs("board_qxs")=board_qxs
rs.update
rs.close
set rs=Nothing
Application(webname&"CacheTime")="2010-3-1 12:12:12"
response.write backmsg("恭喜，分类"&acts&"成功！","AdminManage.asp?Action=boardlists")
End Sub
'-----------------------定义分类删除功能
Sub boarddel()
boardid=checkNum(Request.QueryString("boardid"))
getnum=conn.execute("select count(board_id) from "&BoardTable&" where Board_father="&Boardid&"")
If IsNull(getnum(0)) Or getnum(0)=0 Then
	getallnum=conn.execute("select count(board_id) from "&BoardTable&" where Board_father=0")
	If getallnum(0)=1 Then 
		response.write backmsg("该分类是唯一的分类了不能删除，建议修改分类名称参数使用。","")
	Else
		conn.execute "delete from "&BoardTable&" where Board_id="&Boardid
	End If 
Else
	response.write backmsg("该分类还有子分类"&getnum(0)&"，不能删除","")
End If
Application(webname&"CacheTime")="2010-3-1 12:12:12"
response.write backmsg("恭喜，分类删除成功！","AdminManage.asp?Action=boardlists")
End Sub 

'-----------------------菜单排序的上升功能
Sub boardup()
Board_order=checkStr(Request.QueryString("Board_order"))
	Dim OldOrders,NewOrders
	Set Rs=Server.CreateObject("ADODB.RecordSet")
	Sql="SELECT TOP 2 Board_order from "&BoardTable&" WHERE Board_order>="&Board_order&" ORDER BY Board_order"
	Rs.Open SQL,Conn,1,3
	If Not (Rs.EOF Or Rs.BOF) Then
		OldOrders=rs("Board_order")
		Rs.MoveNext
		If Not (Rs.EOF Or  Rs.BOF) Then
			NewOrders=Rs("Board_order")
			Rs("Board_order")=OldOrders
			Rs.Update
			Rs.MovePrevious
			Rs("Board_order")=NewOrders
			Rs.Update
		End If
	End If
	Rs.Close
	Set Rs=Nothing
	Application(webname&"CacheTime")="2010-3-1 12:12:12"
	Response.Redirect "AdminManage.asp?Action=boardlists"
End Sub 
'-----------------------菜单排序的降序功能
Sub boarddown()
Board_order=checkStr(Request.QueryString("Board_order"))
	Dim OldOrders,NewOrders
	Set Rs=Server.CreateObject("ADODB.RecordSet")
	Sql="SELECT TOP 2 Board_order from "&BoardTable&" WHERE Board_order<="&Board_order&" ORDER BY Board_order desc"
	Rs.Open SQL,Conn,1,3
	If Not (Rs.EOF Or Rs.BOF) Then
		OldOrders=rs("Board_order")
		Rs.MoveNext
		If Not (Rs.EOF Or  Rs.BOF) Then
			NewOrders=Rs("Board_order")
			Rs("Board_order")=OldOrders
			Rs.Update
			Rs.MovePrevious
			Rs("Board_order")=NewOrders
			Rs.Update
		End If
	End If
	Rs.Close
	Set Rs=Nothing
	Application(webname&"CacheTime")="2010-3-1 12:12:12"
	Response.Redirect "AdminManage.asp?Action=boardlists"
End Sub 


'IP管理
sub stopip()
dim ipid,ipcls
ipid=CheckNum(Request.QueryString("id"))
ipcls=Checkstr(trim(Request.QueryString("cls")))

Select case ipcls
case ""

case "delip"
	conn.execute("Delete  From stopip Where id="&ipid)
case "ipadmin0"
    conn.execute("Update stopip set viw=0 Where id="&ipid)
case "ipadmin1"
    conn.execute("Update stopip set viw=1 Where id="&ipid)
case "ipadmin2"
     conn.execute("Update stopip set viw=2 Where id="&ipid)
case "saveip"		'--------Edit by zidone 2006 1214 For Ver 1.1 Dev

	Dim flg,i
	flg = 0
	
	For i = 1 To 4
		If Not IsNumeric(Request.Form("oneip" & i)) Then
			If Trim(Request.Form("oneip" & i)) <> "*" Then 
				flg = 1
				Exit For 
			End If
		End If 
	Next
	If flg = 1 Then
		Response.Write "<script language=JavaScript>{alert('起始IP地址应该全部输入数字或者通配符 *');history.back();}</script>"
		Response.End 
	End If 

	
		dim oneip,endip
		oneip=trim(Request.Form("oneip1")) &"."& trim(Request.Form("oneip2")) &"."& trim(Request.Form("oneip3")) &"."& trim(Request.Form("oneip4")) 
		endip=trim(Request.Form("endip1")) &"."& trim(Request.Form("endip2")) &"."& trim(Request.Form("endip3")) &"."& trim(Request.Form("endip4"))
		If InStr(oneip,"*")<=0 Then
			If InStr(endip,"*")>0 Then
				Response.Write "<script language=JavaScript>{alert('通配符 * 请写在起始地址段的最后一位');history.back();}</script>"
				Response.End 
			End If 
			If endip = "..." Then endip=oneip
			If InStr(endip,"...")>0 Then
				endip = Split(endip,".")(0)&"." & Split(oneip,".")(1)&"." & Split(oneip,".")(2)&"." & Split(oneip,".")(3)
			ElseIf InStr(endip,"..")>0 Then
				endip = Split(endip,".")(0)&"." & Split(endip,".")(1)&"." & Split(oneip,".")(2)&"." & Split(oneip,".")(3)
			ElseIf Right(endip,1) ="." Then 
				endip = Split(endip,".")(0)&"." & Split(oneip,".")(1)&"." & Split(endip,".")(2)&"." & Split(oneip,".")(3)
			End If 
		Else
			endip = "0.0.0.0"

		End If 

		'Valid Check by zidone
		Dim valid
		valid = 0
		If InStr(oneip,"*")<1 And InStr(endip,"*")<1 And endip<>"0.0.0.0" Then
			If Split(oneip,".")(0)>Split(endip,".")(0) Then
				valid=1
			Else
				If Split(oneip,".")(1)>Split(endip,".")(1) Then
					valid = 1
				Else
					If Split(oneip,".")(2)>Split(endip,".")(2) Then
						valid = 1
					Else
						If Split(oneip,".")(3)>Split(endip,".")(3) Then
							valid = 1
						End If 
					End If 
				End if
			End if
		End If 
		
		If valid = 1 Then
			Response.Write "<script language=JavaScript>{alert('起始IP地址应该小于结束IP地址');history.back();}</script>"
			Response.End 
		End If 
		Set rs = Server.CreateObject("ADODB.RecordSet")
		sql="Select * from stopip"
		Rs.open sql,conn,2,3
		Rs.addnew
			  If InStr(oneip,"*")<=0 Then rs("oneip")=cip(oneip)
			  If InStr(endip,"*")<=0 And endip<>"0.0.0.0" Then rs("endip")=cip(endip)
			  rs("ip1")=oneip
			  rs("ip2")=endip
			  rs("rdate")=now()
			  rs("viw")=1
		rs.update
		rs.close
		response.Redirect "AdminManage.asp?Action=stopip"
end Select

Response.Write("<form name='form1' method='post' action='AdminManage.asp?Action=stopip&cls=saveip'><TABLE width=""774"" border=""0"" cellspacing=""1"" cellpadding=""5"" align=""center"" class=""zd_table""><tr class=""zd_td"">  <td colspan='4'><div align='center'>IP管理</div></td></tr><tr class=""zd_td""><td width='19%'><div align='right'>禁用IP段:</div></td><td width='30%'>起始: <input name='oneip1' type='text' maxlength='3'  onKeyPress='return checkNum(event);' id='oneip1' size=4><B>.</B><input name='oneip2' type='text' maxlength='3'  id='oneip2' size=4 onKeyPress='return checkNum(event);'><B>.</B><input name='oneip3' type='text' maxlength='3'  id='oneip3' size=4 onKeyPress='return checkNum(event);'><B>.</B><input name='oneip4' type='text' maxlength='3'  id='oneip4' size=4 onKeyPress='return checkIP(event,this);'></td><td>结束: <input name='endip1' type='text' maxlength='3'  id='endip1' size=4 onKeyPress='return checkNum(event);'><B>.</B><input name='endip2' type='text' maxlength='3'  id='endip2' size=4 onKeyPress='return checkNum(event);'><B>.</B><input name='endip3' type='text' maxlength='3'  id='endip3' size=4 onKeyPress='return checkNum(event);'><B>.</B><input name='endip4' type='text' maxlength='3'  id='endip4' size=4 onKeyPress='return checkIP(event,this);'></td><td><input type='submit' name='Submit' value='添加'></td></tr><tr class=""zd_td""><td><div align='right'>说明:</div></td><input name='action_e' type='hidden' value='stopip'><td colspan='3'><font color=red>起始IP段不能低于终止IP段.<br>起始IP最后一节允许使用通配符 * ,若使用则按照起始IP作为屏蔽依据,结束IP将被忽略(如:192.168.1.*).</font></td></tr></table><br><br></form>")

 set rs=conn.execute("select * from stopip")
Response.Write("<TABLE width=""774"" class=""zd_table"" border=""0"" cellspacing=""1"" cellpadding=""5"" align=""center"" bgcolor=""#b1c9e4""><TBODY>")
Response.Write("<tr class=zd_td><td>状态</td> <td>起始</td><td>终止</td><td>时间</td><td>操作</td></tr>")
do while not rs.eof 
	If InStr(CStr(rs("ip1")),"*")>0 Then
		ip2 = "-.-.-.-"
	Else
		ip2 = rs("ip2")
	End If 
Response.Write("<tr class=zd_td><td>")
             
			  if rs("viw")=1 then
			  Response.write("<font color='#FF9900'>")
			  end if
			  if rs("viw")=0 then
			  Response.write("<font color='#009900'>")
			  end if
			   if rs("viw")=2 then
			  Response.write("<font color='#FF0000'>")
			  end if
              Response.write("●</font>")
			 
Response.Write("</td><td>"&rs("ip1")&"</td> <td>"& ip2 &"</td> <td>"&rs("rdate")&"</td> <td><a href=""AdminManage.asp?Action=stopip&cls=delip&id="&rs("id")&""" >删除</a> <a href=""AdminManage.asp?Action=stopip&cls=ipadmin0&id="&rs("id")&""">开通</a>  <a href=""AdminManage.asp?Action=stopip&cls=ipadmin1&id="&rs("id")&""">禁注</a> <a href=""AdminManage.asp?Action=stopip&cls=ipadmin2&id="&rs("id")&""">禁览</a>  </td> </tr>")
          
		rs.movenext
    	loop
		rs.close
		set rs=nothing

Response.Write("<tr class=zd_td ><td colspan='5'><div align='center'><font color='#009900'>●开通 </font><font color='#FF9900'>●禁止注册</font> <font color='#FF0000'> ●禁止浏览</font><br />全段IP: 0.0.0.0 - 127.255.255.255 , 128.0.0.0 - 255.255.255.255</div></TD></TR></TBODY></TABLE><br><br>")
end sub
'-----------------------定义修改用户列表界面
Sub UserList()
dim ipid,ipcls
uid=CheckNum(Request.QueryString("uid"))
cz=Checkstr(trim(Request.QueryString("cz")))
tiaojian=Checkstr(Trim(Request.Form("tj")))

Select case cz
case "del"
	If uid="" Then response.write backmsg("参数错误！","")
	conn.execute("Delete From "&UserTable&" Where id="&uid)
	response.write backmsg("恭喜，删除成功！！",comurl)
case "lock"
	If uid="" Then response.write backmsg("参数错误！","")
	Set Rs=Server.CreateObject("ADODB.RecordSet")
    SQL="SELECT * FROM "& UserTable &" WHERE id="&uid
    Rs.Open SQL,Conn,1,3
	isLocked=Rs("isLocked")
	If isLocked=1 Then 
		Rs("isLocked")=0
	End If 
    Rs.Update
    Rs.Close
    Set Rs=Nothing
	Response.redirect(comurl)
case "bjsave"
	Dim UserName,PassWord0,PassWord,PassWord1
	UserName=Trim(Request.Form("username"))
	PassWord0=Trim(Request.Form("pwd0"))
	umoney=Int(Request.Form("umoney"))
	user_sex=Int(Request.Form("user_sex"))
	user_from=Trim(Request.Form("user_from"))
	user_mail=Trim(Request.Form("user_mail"))
	user_qq=Trim(Request.Form("user_qq"))
	user_show=Trim(Request.Form("user_show"))
	user_hompage=Trim(Request.Form("user_hompage"))

	lockedTime=Trim(Request.Form("lockedTime"))
	isLocked=int(Request.Form("isLocked"))
	lockedReason=Trim(Request.Form("lockedReason"))
	unLockDay=Trim(Request.Form("unLockDay"))

	uid=Trim(Request.Form("uid"))
	If uid="" Then response.write backmsg("参数错误！","")
	Set Rs=Server.CreateObject("ADODB.RecordSet")
    SQL="SELECT * FROM "& UserTable &" WHERE id="&uid
    Rs.Open SQL,Conn,1,3
	If password0<>"" Then
		Rs("PWD")=MD5(PassWord0)
	End If 
	Rs("user_sex")=user_sex
	Rs("user_from")=user_from
	Rs("user_mail")=user_mail
	Rs("user_qq")=user_qq
	Rs("user_show")=user_show
	Rs("user_homepage")=user_hompage
	Rs("umoney")=umoney
	Rs("isLocked")=isLocked
	If isLocked>0 Then Rs("cookrnd")=""
	Rs("lockedTime")=lockedTime
	Rs("lockedinfo")=lockedReason&"|"&Jle_name&"|"&unLockDay
    Rs.Update
    Rs.Close
    Set Rs=Nothing
	Response.Write backmsg("恭喜您，"&shuoming&"修改成功!",comurl)
case "bj"
	Set Rs_user=Server.CreateObject("ADODB.RecordSet")
    SQL_user="SELECT * FROM "& UserTable &" WHERE id="&uid
    Rs_user.Open SQL_user,Conn,1,3
	user_name=Rs_user("username")
	user_sex=Rs_user("user_sex")
	user_from=Rs_user("user_from")
	user_mail=Rs_user("user_mail")
	user_qq=Rs_user("user_qq")
	user_show=Rs_user("user_show")
	user_hompage=Rs_user("user_homepage")
	umoney=Rs_user("umoney")
	logintimes=Rs_user("logintimes")
	islocked=Rs_user("islocked")
	lockedInfo=Rs_user("lockedInfo")
	lockedTime=Rs_user("lockedTime")
	unlockedTime=dateadd("d",30,lockedTime)
	If InStr(lockedInfo,"|")>0 Then 
		lockedReason=Split(lockedInfo,"|")(0)
		lockedAdmin=Split(lockedInfo,"|")(1)
		unLockDay=Split(lockedInfo,"|")(2)
		If unLockDay="" Or IsNull(unLockDay) Then unLockDay=30
	End If
	Rs_user.Close
    Set Rs_user=Nothing
%>

<form name="save" method="post" action="AdminManage.asp?Action=userList&cz=bjsave">
  <table width="63%" border="1" align="center" cellpadding="3" cellspacing="0" bordercolorlight="#cecece" bordercolordark="#FFFFFF" bgcolor="#C5D5E4"  style="font-size:12px; letter-spacing:1px;">
    <tr >
      <td  class="admintopbg" align="center" colspan=2><B>密码修改</B></td>
    </tr>
    <tr class="zd_td">
      <td width="120" height="30" align="right" bgcolor="#DFDFDF"><strong>帐  号：</strong></td>
      <td bgcolor="#F3F3F3">&nbsp;
      <input name="username" type="text" id="username" size="20" maxlength="20" value="<%=user_name%>" disabled=true></td>
      <input name="uid" type="hidden"  value="<%=uid%>">
    </tr>
    <tr class="zd_td">
      <td height="30" align="right" bgcolor="#DFDFDF"><strong>帐户锁定：</strong></td>
      <td bgcolor="#F3F3F3">&nbsp;
        <select name="isLocked" onChange="if(this.value=='2'){other_hy.style.display='';}">
          <option value="0" <% If islocked=0 Then response.write "selected"%>>正常</option>
          <option value="1" <% If islocked=1 Then response.write "selected"%>>未审核</option>
          <option value="2" <% If islocked=2 Then response.write "selected"%>>锁定</option>
        </select>
        <span id="other_hy" style="display:none">原因：
        <input name="lockedReason" type="text" id="lockedReason" maxlength="80" value="<%=lockedReason%>"/>
        Time:
        <input name="lockedTime" type="text" id="lockedTime" size="18" value="<%=lockedTime%>"/>
        <a href="javascript:" onClick="document.save.lockedTime.value='<%=Now()%>'">←Now</a>
        <input name="unLockDay" size="5" type="text" id="unLockDay" maxlength="5" value="<%=unLockDay%>"/>
        天</span>
        <%If islocked=2 Then response.write "<br>" & lockedinfo & ":" &lockedTime& ":" & unLockDay&"天"%></td>
    </tr>
    <tr class="zd_td">
      <td height="30" align="right" bgcolor="#DFDFDF"><strong> 密 码：</strong></td>
      <td bgcolor="#F3F3F3">&nbsp;
        <input name="pwd0" type="password" id="pwd0" size="20" maxlength="20">
        <font color="#ff0000">如不修改，请留空</font></td>
    </tr>
    <tr class="zd_td">
      <td height="30" align="right" bgcolor="#DFDFDF"><strong>积分：</strong></td>
      <td bgcolor="#F3F3F3">&nbsp;
      <input name="umoney" type="text" id="umoney" size="10" maxlength="8" value="<%=umoney%>"></td>
    </tr>
    <tr class="zd_td">
      <td height="30" align="right" bgcolor="#DFDFDF"><strong>登录信息：</strong></td>
      <td bgcolor="#F3F3F3">&nbsp;共登录<%=logintimes%>次</td>
    </tr>
    <tr class="zd_td">
      <td height="30" align="right" bgcolor="#DFDFDF"><strong>性别：</strong></td>
      <td bgcolor="#F3F3F3">&nbsp;
        <select name="user_sex">
          <option value="0" <% If user_sex<>1 Then response.write "selected"%>>男</option>
          <Option value="1" <% If user_sex=1 Then response.write "selected"%>>女</option>
      </select></td>
    </tr>
    <tr class="zd_td">
      <td height="30" align="right" bgcolor="#DFDFDF"><strong>电子邮件：</strong></td>
      <td bgcolor="#F3F3F3">&nbsp;
      <input name="user_mail" type="text" id="user_mail" size="40" maxlength="50" value="<%=user_mail%>"></td>
    </tr>
    <tr class="zd_td">
      <td height="30" align="right" bgcolor="#DFDFDF"><strong>QQ号码：</strong></td>
      <td bgcolor="#F3F3F3">&nbsp;
      <input name="user_qq" type="text" id="user_qq" size="20" maxlength="12" value="<%=user_qq%>"></td>
    </tr>
    <tr class="zd_td">
      <td height="30" align="right" bgcolor="#DFDFDF"><strong>来自地区：</strong></td>
      <td bgcolor="#F3F3F3">&nbsp;
      <input name="user_from" type="text" id="user_from" size="40" maxlength="40" value="<%=user_from%>"></td>
    </tr>
    <tr class="zd_td">
      <td height="30" align="right" bgcolor="#DFDFDF"><strong>个人主页：</strong></td>
      <td bgcolor="#F3F3F3">&nbsp;
      <input name="user_hompage" type="text" id="user_hompage" size="40" maxlength="200" value="<%=user_hompage%>"></td>
    </tr>
    <tr class="zd_td">
      <td height="30" align="right" bgcolor="#DFDFDF"><strong>个性签名：</strong></td>
      <td bgcolor="#F3F3F3">&nbsp;
        <input name="user_show" type="text" id="user_show" size="40" maxlength="100" value="<%=user_show%>">
        100中文字以内</td>
    </tr>
    <tr class="zd_td">
      <td height="30" align="right" bgcolor="#DFDFDF">&nbsp;</td>
      <td bgcolor="#DFDFDF"><input name="submit" type="submit" id="submit" value="提  交">
        &nbsp;&nbsp;
        <input name="reset" type="reset" id="reset" value="重新填写"></td>
    </tr>
  </table>
</form>
<%
Case "modifyName"
	Call ModifyName()

Case "updName"
	If Request.Form("ouid")="" Or Request.Form("nuid")="" Then
		Response.Write("<script>alert('参数错误，无法提交');window.history.go(-1);</script>")
		Response.End()
	End If 
	nuid = Request.Form("nuid")
	ouid = Request.Form("ouid")
	
	' 判断该用户是否为版主或管理员 'Add For Customer Issue
	if AdminLevel(ouid) > 0 then
		Response.Write(backMsg(ouid&"是版主或管理员,改名前请先释放其权限",""))
		Response.End()
	end if
	
	sqlUpdUname0 = "select [username] from "& UserTable &" where [username]='"&nuid&"'"
	set userExist = conn.Execute(sqlUpdUname0)
	If Not userExist.eof Then
		Response.Write("<script>alert('用户名:"&nuid&" 已存在，请选用其他的名称');window.history.go(-1);</script>")
		Response.End()
	End If 
	sqlUpdUname1 = "update "& UserTable & " Set [username]='"& nuid &"' where [username]='"&ouid&"' "
	sqlUpdUname2 = "update "& bbstable & " Set [username]='"& nuid &"' where [username]='"&ouid&"'"
	sqlUpdUname3 = "update "& bbstable & " Set [rename]='"& nuid &"' where [rename]='"&ouid&"'"
	sqlUpdUname4 = "update "& rebbstable & " Set [username]='"& nuid &"' where [username]='"&ouid&"'"
	sqlUpdUname5 = "update "& "message" & " Set [incept]='"& nuid &"' where [incept]='"&ouid&"'"
	sqlUpdUname6 = "update "& "message" & " Set [sender]='"& nuid &"' where [sender]='"&ouid&"'"
	
	'Add For V1.5 CHANG,ZIDONE 积分表更新'''Begin
	sqlUpdUname7 = "update "& "[Account]" & " Set [accFromUser]='"& nuid &"' where [accFromUser]='"&ouid&"'"
	sqlUpdUname8 = "update "& "[Account]" & " Set [accToUser]='"& nuid &"' where [accToUser]='"&ouid&"'"
	''''''''''''''''''''''''''''''''''''''''End
	conn.Execute(sqlUpdUname1)
	Response.Write("&nbsp;&nbsp;Update User List …… OK!<br />"&VbCrLf )
	conn.Execute(sqlUpdUname2)
	Response.Write("&nbsp;&nbsp;Update BBS Title …… OK!<br />"&VbCrLf)
	conn.Execute(sqlUpdUname3)
	Response.Write("&nbsp;&nbsp;Update LastReply …… OK!<br />"&VbCrLf)
	conn.Execute(sqlUpdUname4)
	Response.Write("&nbsp;&nbsp;Update BBS Reply …… OK!<br />"&VbCrLf)
	conn.Execute(sqlUpdUname5)
	Response.Write("&nbsp;&nbsp;Update ReceiveMSG…… OK!<br />"&VbCrLf)
	conn.Execute(sqlUpdUname6)
	Response.Write("&nbsp;&nbsp;Update Send MSG  …… OK!<br />"&VbCrLf)
	
	'Add For V1.5 CHANG,ZIDONE 积分表更新'''Begin
	conn.Execute(sqlUpdUname7)
	Response.Write("&nbsp;&nbsp;Update [ACCOUNT1]  …… OK!<br />"&VbCrLf)
	conn.Execute(sqlUpdUname8)
	Response.Write("&nbsp;&nbsp;Update [ACCOUNT2]  …… OK!<br />"&VbCrLf)
	''''''''''''''''''''''''''''''''''''''''End
	
	Response.Write("<script>alert('更新用户信息成功，请确定返回');window.location='?Action=userList'</script>")
	Response.End()

Case Else
If tiaojian<>"" Then ptiaojian=" where username like '%"&tiaojian&"%'"
%>
<div class="admintitleft">会员信息管理</div>
<table  class="cssraindemo1" id="table1">
<thead>
<tr >
  <th height="24" align="center" colspan="7"><center>
      <B>会员管理</B>
  </center></th>
</tr></thead>
<tr>
  <form name='tiaojian' method='post' action='AdminManage.asp?Action=userList'>
    <td height="10" align="left" colspan="7">&nbsp;
      会员检索：
      <input name='tj' type='text' size='20' maxlength='10'>
      &nbsp;
      <input  type='submit' name='Submit' value='检索'>
      (* 支持模糊查询)</td>
  </form>
</tr></table><body>
<%
	userUrl = Request.QueryString
	newUrl = ""
	if Instr(userUrl,"order")>0 then
		for ui2=0 to ubound(split(userUrl,"&"))
			if instr(split(userUrl,"&")(ui2),"order")<=0 then 
				newUrl =newUrl & split(userUrl,"&")(ui2) &"&"
			end if
		next 
	else
		newUrl = userUrl
	end if
	if(Right(newUrl,1))="&" then newUrl=Left(newUrl,Len(newUrl)-1)
%>
<tr>
  <th width="26" height="24" ><strong><a href='?<%=newUrl%><%if 1=1 then%>&order=[id]<%end if%>'>ID</a></strong></th>
  <th width="172" height="24" ><strong><a href='?<%=newUrl%><%if 1=1 then%>&order=username<%end if%>'>用户名</a></strong>(点击排序)</th>
  <th width="300" height="24" ><strong><a href='?<%=newUrl%><%if 1=1 then%>&order=regTime<%end if%>'>注册时间</a></strong>(点击排序)</th>
  <th width="50" height="24" ><strong><a href='?<%=newUrl%><%if 1=1 then%>&order=umoney<%end if%>'>积分</a></strong></th>
  <th width="50" height="24" ><strong><a href='?<%=newUrl%><%if 1=1 then%>&order=islocked<%end if%>'>状态</a></strong></th>
  <th height="24"><strong>编辑</strong></th>
  <th height="24"><strong>删除</strong></th>
</tr>
<%set rs2=server.CreateObject("adodb.recordset")
sql2="select * from " & UserTable &" "& ptiaojian
if Request.QueryString("order")<>"" then
	sql2=sql2 & " order by " & CheckStr(Request.QueryString("order")) & " desc"
else
	sql2=sql2 & " order by [id] desc"
end if
rs2.open sql2,conn,1,1
If rs2.eof and rs2.bof Then
response.write "<tr bgcolor=""#FFFFFF"">"
response.write "<td height=""80"" align=""center"" colspan=""6""><center>暂无用户</center></td>"
response.write "</tr>"
else
rs2.PageSize     = MyPageSize
MaxPages         = rs2.PageCount
rs2.absolutepage = MyPage
Totalcount            = rs2.RecordCount
for i=1 to MyPageSize

If not rs2.eof Then
id=rs2("id")
If Int(rs2("islocked"))>0 Then id="<font color=red>"&id&"</font>"
%>
<tr >
  <td height="24" ><%=id%></td>
  <td><a href="UserMng.asp?Action=infoshow&username=<%=rs2("username")%>" target=blank><%=rs2("username")%></a></td>
  <td><%=trim(rs2("regtime"))%></td>
  <td><%=trim(rs2("umoney"))%></td>
  <td><%
	islocked=Int(rs2("islocked"))
	If islocked=1 Then
		response.write"<a href=""AdminManage.asp?Action=userList&cz=lock&uid="&rs2("id")&""">未审核</a>"
	ElseIf islocked=2 Then
		response.write"被锁定"
	Else
		response.write"正常"
	End If %></td>
  <td><a href="AdminManage.asp?Action=userList&cz=bj&uid=<%=rs2("id")%>">编辑</a> <a href="AdminManage.asp?Action=userList&cz=modifyName&uName=<%=rs2("username")%>">改名</a></td>
  <td><a href="AdminManage.asp?Action=userList&cz=del&uid=<%=rs2("id")%>">删除</a></td>
</tr>
<%rs2.MoveNext
End If 
Next
response.write "<tr bgcolor=""#ffffff"">"
response.write "<td height=""30"" align=""center"" colspan=""7"">"& viewpage(Totalcount,MyPageSize,PageShowSize,MyPage,"Action=userList&order="&CheckStr(Request.QueryString("order")),"当前总数:","AdminManage.asp")&"</td>"
response.write "</tr></body>"
End If 
response.write "</table>"
	rs2.close
	set rs2=Nothing
End Select 
End Sub
'回收站
Sub dustBin()
MyPageSize=100
sql7 = "SELECT * FROM "&bbsTable&" where [ischeck]=-1 or [Boardid] is null or [Boardid]=0 or ([boardid] not in (select board_id from "&boardtable&" ))  ORDER BY [addtime] DESC"
Set rs7 = Server.CreateObject("ADODB.Recordset")
rs7.open sql7,conn,1,1
%>
<div class="admintitleft">回收站内容管理</div>
<form action="so.asp?Action=TieDeal" method=post name=inbox>
  <table width="820" border="1" align="center" cellpadding="3" cellspacing="0" bordercolorlight="#cecece" bordercolordark="#FFFFFF" bgcolor="#C5D5E4"  style="font-size:12px; letter-spacing:1px;">
    <tr >
      <td  class="admintopbg"  align="center" colspan="5"><B>网站回收站</B></td>
    </tr>
    <tr class="zd_td">
      <td height="30" align="left" colspan="5" bgColor="#F3F3F3"> 使用说明:<br>
        &nbsp; * 某个贴吧分类被删除后，原分类下所有帖子将会被自动回收到回收站<br>
        &nbsp; * 管理员从前台删除某篇帖子后，该帖子会自动转入到回收站<br>
        &nbsp; * 帖子主题进入回收站后，其回复的帖子不会在下面的“帖子回复”列表中出现<br>
        &nbsp; * 管理员从前台删除某篇回复后，该回复会自动转入到下面的“帖子回复”列表中 </td>
    </tr>
    <tr class="zd_td">
      <td height="30" colspan="5" align="left" bgcolor="#DFDFDF">&nbsp; <B>帖子主题</B>(请删除或者转移)</td>
    </tr>
    <%If rs7.eof and rs7.bof Then%>
    <tr bgcolor="#ffffff">
      <td height="80" colspan="5" align="center" bgcolor="#F3F3F3"><B>暂无帖子</B></td>
    </tr>
    <%Else
rs7.PageSize     = MyPageSize
MaxPages         = rs7.PageCount
rs7.absolutepage = MyPage
Totalcount            = rs7.RecordCount
for i=1 to rs7.PageSize
If not rs7.eof Then
		title=Rs7("title")
		if Rs7("TitleColor")<>"" Then title="<font color="&Rs7("TitleColor")&">"&title&"</font>"
%>
    <tr bgcolor="#ffffff">
      <td width="40" height="24" align="center"><input name=bbsid type=checkbox value="<%=rs7("id")%>"></td>
      
      <td width="480">&nbsp;<A HREF="ShowInfo.asp?id=<%=rs7("id")%>" target=_blank><%=title%></A></td>
      <td width="130" align="center">&nbsp;</td>
      <td width="50" align="center"><a href='edit.asp?tn=bbs&id=<%=rs7("id")%>'>编辑</a>
    </tr>
    <%
rs7.MoveNext
end if
Next
%>
    <tr bgcolor="#ffffff">
      <td height="80" colspan="5" align="center" bgcolor="#DFDFDF"><center>
          移动到：
          <% Call BoardSelect(0)%>
          <input type="checkbox" name="chkall" value="on" onClick="CheckAll(this.form)">
          全选/取消
          <input name="cz" type="radio" value="BatchDel" id="pldel">
          <label for="pldel"> 批量删除(<font color=red>真正删除</font>) </label>
          <input type="radio" name="cz" value="ReDel" id="plre">
          <label for="plre"> 批量还原 </label>
          <input name="Submit" type="submit" class="button" id="Submit" value="执行" onClick="{if(confirm('您确定执行的操作吗?')){return true;}return false;}">
        </center></td>
    </tr>
    <%response.write "<tr bgcolor=""#ffffff"">"
response.write "<td height=""80"" align=""center"" colspan=""5"">"& viewpage(Totalcount,MyPageSize,PageShowSize,MyPage,"Action=dustBin","当前总数:","AdminManage.asp")&"</td>"
response.write "</tr>"
		End if
	rs7.close
	set rs7=Nothing
%>
  </table>
</form>
<%sql7 = "SELECT * FROM "&rebbsTable&" where [ischeck]=-1 ORDER BY addtime DESC"
Set rs7 = Server.CreateObject("ADODB.Recordset")
rs7.open sql7,conn,1,1
%>
<form action="so.asp?Action=TieDeal" method=post name=inbox>

  <table width="820" border="1" align="center" cellpadding="3" cellspacing="0" bordercolorlight="#cecece" bordercolordark="#FFFFFF" bgcolor="#C5D5E4"  style="font-size:12px; letter-spacing:1px;">
    <tr >
      <td  class="admintopbg" align="left" colspan="5">&nbsp; <B>帖子回复</B>(请删除或者还原)</td>
    </tr>
    <%If rs7.eof and rs7.bof Then%>
    <tr bgcolor="#ffffff">
      <td height="80" colspan="5" align="center" bgcolor="#F3F3F3"><B>暂无帖子</B></td>
    </tr>
    <%Else
rs7.PageSize     = MyPageSize
MaxPages         = rs7.PageCount
rs7.absolutepage = MyPage
Totalcount            = rs7.RecordCount
for i=1 to rs7.PageSize
If not rs7.eof Then
retitle=TitleLeft(Rs7("content"),60)
%>
    <tr bgcolor="#ffffff">
      <td width="40" height="24" align="center"><input name=bbsid type=checkbox value="<%=rs7("id")%>"></td>
      
      <td width="480">&nbsp;<A HREF="ShowInfo.asp?id=<%=rs7("re")%>" target=_blank></A><%=retitle%></td>
      <td width="130" align="center">&nbsp;</td>
      <td width="50" align="center"><a href='edit.asp?tn=rebbs&id=<%=rs7("id")%>'>编辑</a>
    </tr>
    <%
rs7.MoveNext
end if
Next
%>
    <tr bgcolor="#ffffff">
      <td height="80" colspan="5" align="center" bgcolor="#F3F3F3"><center>
          <input type="checkbox" name="chkall" id="chkall" value="on" onClick="CheckAll(this.form)">
          <label for="chkall">全选/取消 </label>
          <input name="cz" type="radio" value="BatchDelR" id="BatchDelR">
          <label for="BatchDelR">批量删除(<font color=red>真正删除</font>) </label>
          <input type="radio" name="cz" value="ReDelR" id="ReDelR">
          <label for="ReDelR">批量还原 </label>
          &nbsp;&nbsp;&nbsp;
          <input name="Submit" type="submit" class="button" id="Submit" value="执行" onClick="{if(confirm('您确定执行的操作吗?')){return true;}return false;}">
        </center></td>
    </tr>
    <%response.write "<tr bgcolor=""#ffffff"">"
response.write "<td height=""80"" align=""center"" colspan=""5"">"& viewpage(Totalcount,MyPageSize,PageShowSize,MyPage,"Action=dustBin","当前总数:","AdminManage.asp")&"</td>"
response.write "</tr>"
		End if
	rs7.close
	set rs7=Nothing
%>
  </table>
  <br>
  <br>
</form>
<script language=javascript>
function CheckAll(form1)  {
  for (var i=0;i<form1.elements.length;i++)    {
    var e = form1.elements[i];
    if (e.name != 'chkall')       e.checked = form1.chkall.checked; 
   }
  }
</script>
<%

End Sub 

Sub ModifyName
%>
 <table width="820" border="1" align="center" cellpadding="3" cellspacing="0" bordercolorlight="#cecece" bordercolordark="#FFFFFF" bgcolor="#C5D5E4"  style="font-size:12px; letter-spacing:1px;">
    
  <form name=form1 method=post action="?Action=userList&cz=updName">
   <tr >
      <td  class="admintopbg" align="center" colspan=2><B>修改会员ID</B><br></td>
    </tr>
    <tr class="zd_td">
      <td height="30" colspan=2 align="left" bgcolor="#F3F3F3">&nbsp;&nbsp;* 该操作将改变会员的ID,以及所有该会员在贴吧的发帖、回帖、短消息及其他涉及到ID的地方。<br>
        &nbsp;&nbsp;* 请慎用。 </td>
    </tr>
    <tr class="zd_td">
      <td height="30" align="right" bgcolor="#FFFFFF"><strong>原ID:</strong></td>
      <td bgcolor="#FFFFFF">&nbsp;<%=checkStr(Request.QueryString("uName"))%></td>
    </tr>
    <tr class="zd_td">
      <td height="30" align="right" bgcolor="#FFFFFF"><strong>变更为:</strong></td>
      <td bgcolor="#FFFFFF">&nbsp;
        <input type="text" name="nuid" value="<%=checkStr(Request.QueryString("uName"))%>"/>
        <input type="hidden" name="ouid" value="<%=checkStr(Request.QueryString("uName"))%>"/></td>
    </tr>
    <tr class="zd_td">
      <td height="30" colspan=2 align="center" bgcolor="#F3F3F3"><span onClick="if(!confirm('确定要更改此名称?'))return false;">
        <input type="submit" name="sb" value="执行变更" />
        </span>
        <input type="button" name="rs" onClick="history.go(-1);" value="返回上页" />
        <br></td>
    </tr>
  </form>
</table>
<%
End Sub
Sub friendlink()
cls=Checkstr(trim(Request.QueryString("cls")))
lid=CheckNum(trim(Request.QueryString("id")))
Select case cls
case ""
case "del"
	conn.execute("Delete  From "&LinkTable&" Where id="&lid)
	response.write backmsg("恭喜，链接删除成功！","AdminManage.asp?Action=friendlink")
case "up"
Link_order=checkStr(Request.QueryString("link_order"))
	Dim OldOrders,NewOrders
	Set Rs=Server.CreateObject("ADODB.RecordSet")
	Sql="SELECT TOP 2 link_order from "&LinkTable&" WHERE link_order>="&link_order&" ORDER BY link_order"
	Rs.Open SQL,Conn,1,3
	If Not (Rs.EOF Or Rs.BOF) Then
		OldOrders=rs("link_order")
		Rs.MoveNext
		If Not (Rs.EOF Or  Rs.BOF) Then
			NewOrders=Rs("link_order")
			Rs("link_order")=OldOrders
			Rs.Update
			Rs.MovePrevious
			Rs("link_order")=NewOrders
			Rs.Update
		End If
	End If
	Rs.Close
	Set Rs=Nothing
	Response.Redirect "AdminManage.asp?Action=friendlink"
case "down"
link_order=checkStr(Request.QueryString("link_order"))
	Set Rs=Server.CreateObject("ADODB.RecordSet")
	Sql="SELECT TOP 2 link_order from "&linkTable&" WHERE link_order<="&link_order&" ORDER BY link_order desc"
	Rs.Open SQL,Conn,1,3
	If Not (Rs.EOF Or Rs.BOF) Then
		OldOrders=rs("link_order")
		Rs.MoveNext
		If Not (Rs.EOF Or  Rs.BOF) Then
			NewOrders=Rs("link_order")
			Rs("link_order")=OldOrders
			Rs.Update
			Rs.MovePrevious
			Rs("link_order")=NewOrders
			Rs.Update
		End If
	End If
	Rs.Close
	Set Rs=Nothing
	Response.Redirect "AdminManage.asp?Action=friendlink"
case "save"

id=Request.Form("fid")
Link_name=CStr(Request.Form("Link_name"))
Link_info=Request.Form("Link_info")
Link_url=Request.Form("Link_url")

If Link_name="" Or Len(Link_name)>100 Then response.write backmsg("名称太短或者太长","")
If Link_info="" Or Len(Link_info)>200 Then response.write backmsg("说明太短或者太长","")
If Link_url="" Or Len(Link_info)>200 Then response.write backmsg("地址太短或者太长","")
Set rs = Server.CreateObject("ADODB.Recordset")
'判断是修改还是添加
If id="" Or id=0 Then'如果是添加
		'这里首先要读取最大排序数字，为的是给新添加的排序字段有数据输入。
		Set Rs77=Conn.Execute("SELECT Max(Link_order) FROM "& LinkTable &"")
			If Rs77.EOF Or Rs77.BOF Then 
				Link_order=1
			Else
				Link_order=Rs77(0)+1
			End If
		If IsNull(Link_order) Then Link_order=1
		'读取排序号结束。
acts="添加"
sql = "SELECT * FROM "&LinkTable&" where (id is null)" 
rs.OPEN sql,Conn,1,3
rs.addnew
rs("Link_order")=Link_order
Else
acts="修改"
sql = "SELECT * FROM "&LinkTable&" where id="&id 
rs.OPEN sql,Conn,1,3
End If 
rs("Link_name")=Link_name
rs("Link_url")=Link_url
rs("Link_info")=Link_info
rs.update
rs.close
set rs=Nothing
conn.close
set conn=nothing
response.write backmsg("恭喜，链接"&acts&"成功！","AdminManage.asp?Action=friendlink")
End Select 
%>
<div class="admintitleft">友情连接管理</div>
<table class="cssraindemo1" id="table1">
  <thead><tr>
    <th   height="24">ID
    <th width="172" height="24" >名称(点击进入修改)</th>
    <th width="200" height="24" >简介</th>
    <th width="200" height="24" >地址</th>
    <th width="32" height="24" >排序</th>
    <th width="84" height="24">操作</th>
  </tr>
  </thead>
  <%set rs2=server.CreateObject("adodb.recordset")
sql="select * from "&LinkTable&" where link_type=0 order by link_order desc,id desc"
rs2.open sql,conn,1,1
do while not rs2.eof
%>
  <tr>
    <td height="24" ><%=rs2("id")%></td>
    <td ><a href="AdminManage.asp?Action=friendlink&cls=edit&id=<%=rs2("id")%>"><%=rs2("link_name")%></a></td>
    <td ><%=left(trim(rs2("link_info")),100)%></td>
    <td ><a href="<%=trim(rs2("link_url"))%>" target=_blank><%=trim(rs2("link_url"))%></a></td>
    <td ><a href="AdminManage.asp?Action=friendlink&cls=up&link_order=<%=rs2("link_order")%>">↑</a> <a href="AdminManage.asp?Action=friendlink&cls=down&link_order=<%=rs2("link_order")%>">↓</a></td>
    <td ><a href="AdminManage.asp?Action=friendlink&cls=del&id=<%=rs2("id")%>">删除</a></td>
  </tr>
  <%rs2.movenext
	loop%></table></body>


<%
If cls="edit" And lid<>"" Then
shuoming="编辑"
set rs2=server.CreateObject("adodb.recordset")
sql="select * from "&LinkTable&" where id="&lid
rs2.open sql,conn,1,1
If rs2.eof Or rs2.bof Then 
Call backmsg("参数错误或者无此链接","")
Else
link_name=rs2("link_name")
link_url=rs2("link_url")
link_info=rs2("link_info")
End If
Else
shuoming="新增加"
End If 
%>
<BR>
<CENTER>
  <B><%=shuoming%>链接</B>
</CENTER>
<form name='form1' method='post' action='AdminManage.asp?Action=friendlink&cls=save'>
  <table class="cssraindemo1" id="table1">
     <thead><tr>
    <th   height="24">ID
    <th width="172" height="24"  >名称(点击进入修改)</th>
    <th width="200" height="24"  >简介</th>
    <th width="200" height="24" >地址</th>
    <th width="32" height="24" >排序</th>
    <th width="84" height="24" >操作</th>
  </tr>
  </thead></form><body>
    <tr>
      <td width="26" height="24"><input name="fid" type="hidden" id="id" value="<%=lid%>"></td>
      <td width="172" height="24"><input name="link_name" type="text" id="link_name" size="20" maxlength="20" value="<%=link_name%>"></td>
      <td width="200" height="24"><input name="link_info" type="text" id="link_info" size="20" maxlength="200" value="<%=link_info%>"></td>
      <td width="200" height="24"><input name="link_url" type="text" id="link_url" size="20" maxlength="200" value="<%=link_url%>"></td>
      <td width="32" height="24">排序</td>
      <td width="84" height="24"><input type='submit' name='Submit' value='<%=shuoming%> 提交'></td>
    </tr></body>
  </table>

<!--文字导航链接区-->
<%
End Sub
%>
<% sub jletxt1() %>
<div class="admintitleft">管理</div>
<%set rs=server.createobject("adodb.recordset")
sql="select * from jle_txt1 where g_id=1"
rs.open sql,conn,1,1%>
<table width="820" border="1" align="center" cellpadding="3" cellspacing="0" bordercolorlight="#335078" bordercolordark="#FFFFFF" bgcolor="#C5D5E4">
<form name="g_form" method="post" action="inctxt1.asp" onSubmit="return chk()">
<tr>
<td height="30" align="center"><strong></strong></td>
</tr>
<tr>
<td align="center" bgcolor="#DBE4EE">
<textarea name="content" id="content" style="display:none"><%=rs("g_content")%></textarea><iframe id="FCK_Frame" src="cominc/editor/fckeditor.html?InstanceName=content&amp;Toolbar=Default" width="620" height="300" frameborder="no" scrolling="no"></iframe>
</td>
</tr>
<tr>
<td align="center" bgcolor="#EBF0F5"><input type="submit" value="确定提交">
 </td>
</tr>
</form>
</table>
<%End Sub%>
<% sub jletxt2() %>
<div class="admintitleft">免责申明管理</div>
<%set rs=server.createobject("adodb.recordset")
sql="select * from jle_txt2 where g_id=1"
rs.open sql,conn,1,1%>
<table width="820" border="1" align="center" cellpadding="3" cellspacing="0" bordercolorlight="#335078" bordercolordark="#FFFFFF" bgcolor="#C5D5E4">
<form name="g_form" method="post" action="inctxt2.asp" onSubmit="return chk()">
<tr>
<td height="30" align="center"><strong>免责申明</strong></td>
</tr>
<tr>
<td align="center" bgcolor="#DBE4EE">
<textarea name="content" id="content" style="display:none"><%=rs("g_content")%></textarea><iframe id="FCK_Frame" src="cominc/editor/fckeditor.html?InstanceName=content&amp;Toolbar=Default" width="620" height="300" frameborder="no" scrolling="no"></iframe>
</td>
</tr>
<tr>
<td align="center" bgcolor="#EBF0F5"><input type="submit" value="确定提交">
 </td>
</tr>
</form>
</table>
<%End Sub%>

<% sub jletxt3() %>
<div class="admintitleft">广告服务管理</div>
<%set rs=server.createobject("adodb.recordset")
sql="select * from jle_txt3 where g_id=1"
rs.open sql,conn,1,1%>
<table width="820" border="1" align="center" cellpadding="3" cellspacing="0" bordercolorlight="#335078" bordercolordark="#FFFFFF" bgcolor="#C5D5E4">
<form name="g_form" method="post" action="inctxt3.asp" onSubmit="return chk()">
<tr>
<td height="30" align="center"><strong>广告服务</strong></td>
</tr>
<tr>
<td align="center" bgcolor="#DBE4EE">
<textarea name="content" id="content" style="display:none"><%=rs("g_content")%></textarea><iframe id="FCK_Frame" src="cominc/editor/fckeditor.html?InstanceName=content&amp;Toolbar=Default" width="620" height="300" frameborder="no" scrolling="no"></iframe>
</td>
</tr>
<tr>
<td align="center" bgcolor="#EBF0F5"><input type="submit" value="确定提交">
 </td>
</tr>
</form>
</table>
<%End Sub%>

<% sub jletxt4() %>
<div class="admintitleft">联系我们管理</div>
<%set rs=server.createobject("adodb.recordset")
sql="select * from jle_txt4 where g_id=1"
rs.open sql,conn,1,1%>
<table width="820" border="1" align="center" cellpadding="3" cellspacing="0" bordercolorlight="#335078" bordercolordark="#FFFFFF" bgcolor="#C5D5E4">
<form name="g_form" method="post" action="inctxt4.asp" onSubmit="return chk()">
<tr>
<td height="30" align="center"><strong>联系我们</strong></td>
</tr>
<tr>
<td align="center" bgcolor="#DBE4EE">
<textarea name="content" id="content" style="display:none"><%=rs("g_content")%></textarea><iframe id="FCK_Frame" src="cominc/editor/fckeditor.html?InstanceName=content&amp;Toolbar=Default" width="620" height="300" frameborder="no" scrolling="no"></iframe>
</td>
</tr>
<tr>
<td align="center" bgcolor="#EBF0F5"><input type="submit" value="确定提交">
 </td>
</tr>
</form>
</table>
<%End Sub%>

<% sub jletxt5() %>
<div class="admintitleft">帮助中心管理</div>
<%set rs=server.createobject("adodb.recordset")
sql="select * from jle_txt5 where g_id=1"
rs.open sql,conn,1,1%>
<table width="820" border="1" align="center" cellpadding="3" cellspacing="0" bordercolorlight="#335078" bordercolordark="#FFFFFF" bgcolor="#C5D5E4">
<form name="g_form" method="post" action="inctxt5.asp" onSubmit="return chk()">
<tr>
<td height="30" align="center"><strong>帮助中心</strong></td>
</tr>
<tr>
<td align="center" bgcolor="#DBE4EE">
<textarea name="content" id="content" style="display:none"><%=rs("g_content")%></textarea><iframe id="FCK_Frame" src="cominc/editor/fckeditor.html?InstanceName=content&amp;Toolbar=Default" width="620" height="300" frameborder="no" scrolling="no"></iframe>
</td>
</tr>
<tr>
<td align="center" bgcolor="#EBF0F5"><input type="submit" value="确定提交">
 </td>
</tr>
</form>
</table>
<%End Sub%>

<%
sub topmenu1()
cls=Checkstr(trim(Request.QueryString("cls")))
lid=CheckNum(trim(Request.QueryString("id")))
Select case cls
case ""
case "del"
	conn.execute("Delete  From jle_topmenu Where id="&lid)
	response.write backmsg("恭喜，链接删除成功！","AdminManage.asp?Action=topmenu1")
case "save"

id=Request.Form("fid")
Link_name=CStr(Request.Form("Link_name"))

Link_url=Request.Form("Link_url")

If Link_name="" Or Len(Link_name)>100 Then response.write backmsg("名称太短或者太长","")

If Link_url="" Or Len(Link_info)>200 Then response.write backmsg("地址太短或者太长","")
Set rs = Server.CreateObject("ADODB.Recordset")
'判断是修改还是添加
If id="" Or id=0 Then'如果是添加
		'这里首先要读取最大排序数字，为的是给新添加的排序字段有数据输入。
		Set Rs77=Conn.Execute("SELECT Max(Link_order) FROM jle_topmenu")
			If Rs77.EOF Or Rs77.BOF Then 
				Link_order=1
			Else
				Link_order=Rs77(0)+1
			End If
		If IsNull(Link_order) Then Link_order=1
		'读取排序号结束。
acts="添加"
sql = "SELECT * FROM jle_topmenu where (id is null)" 
rs.OPEN sql,Conn,1,3
rs.addnew
rs("Link_order")=Link_order
Else
acts="修改"
sql = "SELECT * FROM jle_topmenu where id="&id 
rs.OPEN sql,Conn,1,3
End If 
rs("Link_name")=Link_name
rs("Link_url")=Link_url

rs.update
rs.close
set rs=Nothing
conn.close
set conn=nothing
response.write backmsg("恭喜，链接"&acts&"成功！","AdminManage.asp?Action=topmenu1")
End Select 
%>
<div class="admintitleft">顶部菜单管理</div>
<table class="cssraindemo1" id="table1"><body>
     <thead><tr>
    <th  height="24">ID</th>
    <th width="372" height="24" >菜单名称(点击进入修改)</th>
    
    <th width="200" height="24" >地址</th>
    <th width="32" height="24" >排序</th>
    <th width="84" height="24">操作</th>
  </tr></thead>
<%set rs2=server.CreateObject("adodb.recordset")
sql="select * from jle_topmenu  order by id desc"
rs2.open sql,conn,1,1
do while not rs2.eof
%>
  <tr >
    <td height="24" ><%=rs2("id")%></td>
    <td ><a href="AdminManage.asp?Action=topmenu1&cls=edit&id=<%=rs2("id")%>"><%=rs2("link_name")%></a></td>
    
    <td ><a href="<%=trim(rs2("link_url"))%>" target=_blank><%=trim(rs2("link_url"))%></a></td>
    
    <td><a href="AdminManage.asp?Action=topmenu1&cls=del&id=<%=rs2("id")%>">删除</a></td>
  </tr>
  <%rs2.movenext
	loop%></body>
</table>

<%
If cls="edit" And lid<>"" Then
shuoming="编辑"
set rs2=server.CreateObject("adodb.recordset")
sql="select * from jle_topmenu where id="&lid
rs2.open sql,conn,1,1
If rs2.eof Or rs2.bof Then 
Call backmsg("参数错误或者无此链接","")
Else
link_name=rs2("link_name")
link_url=rs2("link_url")

End If
Else
shuoming="新增加"
End If 
%>
<BR>
<CENTER>
  <B><%=shuoming%>链接</B>
</CENTER>
<form name='form1' method='post' action='AdminManage.asp?Action=topmenu1&cls=save'>
  <table class="cssraindemo1" id="table1">
  <body>
     <thead><tr>
      <th   height="24">ID</th>
      <th width="372" height="24" class="admintopbg">名称</th>
     
      <th width="200" height="24" class="admintopbg">地址</th>
      
      <th width="84" height="24" class="admintopbg">操作</th>
    </tr></thead>
    <tr >
      <td width="26" height="24" ><input name="fid" type="hidden" id="id" value="<%=lid%>"></td>
      <td width="372" height="24" ><input name="link_name" type="text" id="link_name" size="20" maxlength="20" value="<%=link_name%>"></td>
      
      <td width="200" height="24" ><input name="link_url" type="text" id="link_url" size="20" maxlength="200" value="<%=link_url%>"></td>
      
      <td width="84" height="24" ><input type='submit' name='Submit' value='<%=shuoming%> 提交'></td>
    </tr>
 <body>
  </table></form>

<% end sub %>