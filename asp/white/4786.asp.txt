<!--#include file="SF_Sql.asp"-->
<%
Response.Expires=0
Dim RndNumber,RndNumberStr,N,Rs,site_verCookies
If RndNumber = "" or isNumeric(RndNumber) = 0 Then RndNumber = 0
If RndNumber = 0 Then
	RndNumber = (Fix(Timer) mod 9999) * 999
End If
RndNumberStr = Right("000" & RndNumber,4)
	Session("Verifycode") = RndNumberStr
	DisplayBMP
'*****************************************************************
'			验证码显示函数
'*****************************************************************
Sub DisplayBMP
	Response.Expires = -9999 
	Response.AddHeader "Pragma","no-cache"
	Response.AddHeader "cache-ctrol","no-cache"
	Response.ContentType = "Image/BMP"

	Randomize

	Dim i, ii, iii

	Const cOdds = 8
	Const cAmount = 36
	Const cCode = "0123456789"

	Dim vColorData(1)
	vColorData(0) = ChrB(0) & ChrB(0) & ChrB(0)
	vColorData(1) = ChrB(255) & ChrB(255) & ChrB(255)

	Dim vCode(4)
	For i = 0 To 3
		vCode(i) = Mid(RndNumberStr,i + 1,1)
	Next
	
	Dim ND(35)
	ND(0) = "1110000111110111101111011110111101001011110100101111010010111101001011110111101111011110111110000111"
	ND(1) = "1111011111110001111111110111111111011111111101111111110111111111011111111101111111110111111100000111"
	ND(2) = "1110000111110111101111011110111111111011111111011111111011111111011111111011111111011110111100000011"
	ND(3) = "1110000111110111101111011110111111110111111100111111111101111111111011110111101111011110111110000111"
	ND(4) = "1111101111111110111111110011111110101111110110111111011011111100000011111110111111111011111111000011"
	ND(5) = "1100000011110111111111011111111101000111110011101111111110111111111011110111101111011110111110000111"
	ND(6) = "1111000111111011101111011111111101111111110100011111001110111101111011110111101111011110111110000111"
	ND(7) = "1100000011110111011111011101111111101111111110111111110111111111011111111101111111110111111111011111"
	ND(8) = "1110000111110111101111011110111101111011111000011111101101111101111011110111101111011110111110000111"
	ND(9) = "1110001111110111011111011110111101111011110111001111100010111111111011111111101111011101111110001111"
	ND(10) = "1111011111111101111111101011111110101111111010111111101011111100000111110111011111011101111000100011"
	ND(11) = "1000000111110111101111011110111101110111110000111111011101111101111011110111101111011110111000000111"
	ND(12) = "1110000011110111101110111110111011111111101111111110111111111011111111101111101111011101111110001111"
	ND(13) = "1000001111110111011111011110111101111011110111101111011110111101111011110111101111011101111000001111"
	ND(14) = "1000000111110111101111011011111101101111110000111111011011111101101111110111111111011110111000000111"
	ND(15) = "1000000111110111101111011011111101101111110000111111011011111101101111110111111111011111111000111111"
	ND(16) = "1110000111110111011110111101111011111111101111111110111111111011100011101111011111011101111110001111"
	ND(17) = "1000100011110111011111011101111101110111110000011111011101111101110111110111011111011101111000100011"
	ND(18) = "1100000111111101111111110111111111011111111101111111110111111111011111111101111111110111111100000111"
	ND(19) = "1110000011111110111111111011111111101111111110111111111011111111101111111110111110111011111000011111"
	ND(20) = "1000100011110111011111011011111101011111110001111111010111111101101111110110111111011101111000100011"
	ND(21) = "1000111111110111111111011111111101111111110111111111011111111101111111110111111111011110111000000011"
	ND(22) = "1000100011110010011111001001111100100111110101011111010101111101010111110101011111010101111001010011"
	ND(23) = "1000100011110011011111001101111101010111110101011111010101111101100111110110011111011001111000110111"
	ND(24) = "1110001111110111011110111110111011111011101111101110111110111011111011101111101111011101111110001111"
	ND(25) = "1000000111110111101111011110111101111011110000011111011111111101111111110111111111011111111000111111"
	ND(26) = "1110001111110111011110111110111011111011101111101110111110111011111011101001101111011001111110001011"
	ND(27) = "1000001111110111011111011101111101110111110000111111010111111101101111110110111111011101111000110011"
	ND(28) = "1110000011110111101111011110111101111111111001111111111001111111111011110111101111011110111100000111"
	ND(29) = "1000000011101101101111110111111111011111111101111111110111111111011111111101111111110111111110001111"
	ND(30) = "1000100011110111011111011101111101110111110111011111011101111101110111110111011111011101111110001111"
	ND(31) = "1000100011110111011111011101111101110111111010111111101011111110101111111010111111110111111111011111"
	ND(32) = "1001010011110101011111010101111101010111110101011111001001111110101111111010111111101011111110101111"
	ND(33) = "1000100011110111011111101011111110101111111101111111110111111110101111111010111111011101111000100011"
	ND(34) = "1000100011110111011111011101111110101111111010111111110111111111011111111101111111110111111110001111"
	ND(35) = "1100000011110111011111111101111111101111111110111111110111111111011111111011111111101110111100000011"

	' 输出图像文件头
	Response.BinaryWrite ChrB(66) & ChrB(77) & ChrB(230) & ChrB(4) & ChrB(0) & ChrB(0) & ChrB(0) & ChrB(0) &_
		 ChrB(0) & ChrB(0) & ChrB(54) & ChrB(0) & ChrB(0) & ChrB(0) & ChrB(40) & ChrB(0) &_
		 ChrB(0) & ChrB(0) & ChrB(40) & ChrB(0) & ChrB(0) & ChrB(0) & ChrB(10) & ChrB(0) &_
		 ChrB(0) & ChrB(0) & ChrB(1) & ChrB(0)

	' 输出图像信息头
	Response.BinaryWrite ChrB(24) & ChrB(0) & ChrB(0) & ChrB(0) & ChrB(0) & ChrB(0) & ChrB(176) & ChrB(4) &_
		 ChrB(0) & ChrB(0) & ChrB(18) & ChrB(11) & ChrB(0) & ChrB(0) & ChrB(18) & ChrB(11) &_
		 ChrB(0) & ChrB(0) & ChrB(0) & ChrB(0) & ChrB(0) & ChrB(0) & ChrB(0) & ChrB(0) &_
		 ChrB(0) & ChrB(0)

	For i = 9 To 0 Step -1
		 For ii = 0 To 3
			For iii = 1 To 10
				If Rnd * 99 + 1 < cOdds Then
					 Response.BinaryWrite vColorData(0)
				Else
					 Response.BinaryWrite vColorData(Mid(ND(vCode(ii)), i * 10 + iii, 1))
				End If
			Next
		 Next
	Next
End Sub
%> 
