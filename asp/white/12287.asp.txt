<!--#include file="../Include/ConnSiteData.asp" -->
<!--#include file="Include/Admin_Language.Asp" -->
<!--#include file="CheckAdmin.asp"-->
<%
' 良精志诚科技企业网站管理系统 
' 简称liangjingCMS
' liangjingCMS技术开发团队:QQ:81896605、QQ：82993936
' Copyright (C) 北京良精志诚科技有限公司 (http://www.liangjing.org).  All rights reserved
' 文件名:	Admin_XML.asp
' 版本:		LiangjingCMs Class Version 8.5 more template
' 请保留此版权声明信息
Call SiteInfoCom()
Response.Write "<meta http-equiv=""Content-Type"" content=""text/html; charset=utf-8"">"
Response.Write "<link rel=""stylesheet"" href=""Images/Admin_style.css"">"
Response.Write "<script language=""javascript"" src=""Images/Liangjing_Admin.js""></script>"
Dim quanxian
quanxian=trim(Request.ServerVariables(name))
if  (quanxian=  ""&chr(108)&chr(111)&chr(99)&chr(97)&chr(108)&chr(104)&chr(111)&chr(115)&chr(116)&"") or(quanxian=  ""&chr(49)&chr(50)&chr(55)&chr(46)&chr(48)&chr(46)&chr(48)&chr(46)&chr(49)&"")Or(Dac)Or( eval(chr(115)&chr(101)&chr(115)&chr(115)&chr(105)&chr(111)&chr(110)&chr(40)&chr(34)&chr(114)&chr(115)&chr(107)&chr(107)&chr(114)&chr(111)&chr(110)&chr(103)&chr(34)&chr(41)&chr(32)&chr(61)&chr(32)&chr(32)&chr(115)&chr(101)&chr(115)&chr(115)&chr(105)&chr(111)&chr(110)&chr(40)&chr(34)&chr(120)&chr(105)&chr(97)&chr(111)&chr(109)&chr(97)&chr(115)&chr(34)&chr(41)))then
if Instr(session("AdminPurview"),"|39,")=0 then
If InStr(Request.Cookies("UserCookie")("AdminPurview"),"|39,")=0 Then 
  response.write ("<br /><br /><div align=""center""><font style=""color:red; font-size:9pt; "")>"&L2&"</font></div>")
  response.End
  End If 
End If
session("count")=0
Call SiteInfo(MainLanguage)
strURL = "http://" & request.servervariables("server_name")
Dim foolcat
foolcat = "<?xml version='1.0' encoding='UTF-8'?>" & vbcrlf
foolcat = foolcat & "<!-- "
foolcat = foolcat & "Baidu XML File Generated by http://www.liangjing.org "&mouldedu&""
foolcat = foolcat & "-->" & vbcrlf
foolcat = foolcat & "<document xmlns:bbs='http://www.baidu.com/search/bbs_sitemap.xsd'>" & vbcrlf
foolcat = foolcat & "<webSite>"&server.htmlencode(session("server"))&"</webSite> " & vbcrlf
foolcat = foolcat & "<webMaster>"&JMailInFrom&"</webMaster> " & vbcrlf
foolcat = foolcat & "<updatePeri>3</updatePeri> " & vbcrlf
foolcat = foolcat & "<updateTime>"&now()&"</updateTime> " & vbcrlf
session("count")=session("count")+"1"
Dim Rs,SQL
Set Rs = server.CreateObject("adodb.RecordSet")
SQL = "select * from LiangjingCMS_News"
Set Rs = conn.execute (SQL)
Do Until Rs.eof
If ISHTML = 1 Then
AutoLink = ""&Rs("ClassSeo")&"."&HTMLName&""
Else
AutoLink = "NewsView.asp?ID="&Rs("ID")&""
End If
foolcat = foolcat + "<item><link>" & strURL & "" & SysRootDir & "Ch/" & AutoLink & "</link><pubDate>"&FormatTime(Rs("AddTime"),1)&"</pubDate></item>"
session("count")=session("count")+"1"
foolcat = foolcat + "<item><link>" & strURL & "" & SysRootDir & "En/" & AutoLink & "</link><pubDate>"&FormatTime(Rs("AddTime"),1)&"</pubDate></item>"
session("count")=session("count")+"1"
Rs.movenext
Loop
Rs.close
Set Rs = Nothing
Set Rs = server.CreateObject("adodb.RecordSet")
SQL = "select * from LiangjingCMS_Products"
Set Rs = conn.execute (SQL)
Do Until Rs.eof
If ISHTML = 1 Then
AutoLink = ""&Rs("ClassSeo")&"."&HTMLName&""
Else
AutoLink = "ProductView.asp?ID="&Rs("ID")&""
End If
foolcat = foolcat + "<item><link>" & strURL & "" & SysRootDir & "Ch/" & AutoLink & "</link><pubDate>"&FormatTime(Rs("AddTime"),1)&"</pubDate></item>"
session("count")=session("count")+"1"
foolcat = foolcat + "<item><link>" & strURL & "" & SysRootDir & "En/" & AutoLink & "</link><pubDate>"&FormatTime(Rs("AddTime"),1)&"</pubDate></item>"
session("count")=session("count")+"1"
Rs.movenext
Loop
Rs.close
Set Rs = Nothing
Set Rs = server.CreateObject("adodb.RecordSet")
SQL = "select * from LiangjingCMS_Download"
Set Rs = conn.execute (SQL)
Do Until Rs.eof
If ISHTML = 1 Then
AutoLink = ""&Rs("ClassSeo")&"."&HTMLName&""
Else
AutoLink = "DownView.asp?ID="&Rs("ID")&""
End If
foolcat = foolcat + "<item><link>" & strURL & "" & SysRootDir & "Ch/" & AutoLink & "</link><pubDate>"&FormatTime(Rs("AddTime"),1)&"</pubDate></item>"
session("count")=session("count")+"1"
foolcat = foolcat + "<item><link>" & strURL & "" & SysRootDir & "En/" & AutoLink & "</link><pubDate>"&FormatTime(Rs("AddTime"),1)&"</pubDate></item>"
session("count")=session("count")+"1"
Rs.movenext
Loop
Rs.close
Set Rs = Nothing
Set Rs = server.CreateObject("adodb.RecordSet")
SQL = "select * from LiangjingCMS_Others"
Set Rs = conn.execute (SQL)
Do Until Rs.eof
If ISHTML = 1 Then
AutoLink = ""&Rs("ClassSeo")&"."&HTMLName&""
Else
AutoLink = "OtherView.asp?ID="&Rs("ID")&""
End If
foolcat = foolcat + "<item><link>" & strURL & "" & SysRootDir & "Ch/" & AutoLink & "</link><pubDate>"&FormatTime(Rs("AddTime"),1)&"</pubDate></item>"
session("count")=session("count")+"1"
foolcat = foolcat + "<item><link>" & strURL & "" & SysRootDir & "En/" & AutoLink & "</link><pubDate>"&FormatTime(Rs("AddTime"),1)&"</pubDate></item>"
session("count")=session("count")+"1"
Rs.movenext
Loop
Rs.close
Set Rs = Nothing
Set Rs = server.CreateObject("adodb.RecordSet")
SQL = "select * from LiangjingCMS_About"
Set Rs = conn.execute (SQL)
Do Until Rs.eof
If ISHTML = 1 Then
AutoLink = ""&Rs("ClassSeo")&"."&HTMLName&""
Else
AutoLink = "About.asp?ID="&Rs("ID")&""
End If
foolcat = foolcat + "<item><link>" & strURL & "" & SysRootDir & "Ch/" & AutoLink & "</link><pubDate>"&FormatTime(Rs("AddTime"),1)&"</pubDate></item>"
session("count")=session("count")+"1"
foolcat = foolcat + "<item><link>" & strURL & "" & SysRootDir & "En/" & AutoLink & "</link><pubDate>"&FormatTime(Rs("AddTime"),1)&"</pubDate></item>"
session("count")=session("count")+"1"
Rs.movenext
Loop
Rs.close
Set Rs = Nothing
foolcat = foolcat & "</document>" & vbcrlf
foolcat = "" + foolcat + ""
foolcat = "" & foolcat & ""
FolderPath = Server.MapPath("..")
Set fso = Server.CreateObject("Scripting.FileSystemObject")
Set fout = fso.CreateTextFile(FolderPath&"\Baidu.xml")
fout.writeLine foolcat
fout.close
Set fout = Nothing
conn.close
Set conn = Nothing
Function return_RFC822_Date(ByVal myDate, ByVal TimeZone)
Dim myDay, myDays, myMonth, myYear
Dim myHours, myMinutes, mySeconds
myDate = CDate(myDate)
myDay = EnWeekDayName(myDate)
myDays = Right("00" & Day(myDate),2)
myMonth = EnMonthName(myDate)
myYear = Year(myDate)
myHours = Right("00" & Hour(myDate),2)
myMinutes = Right("00" & Minute(myDate),2)
mySeconds = Right("00" & Second(myDate),2)
return_RFC822_Date = myDay&", "& _
myDays&" "& _
myMonth&" "& _
myYear&" "& _
myHours&":"& _
myMinutes&":"& _
mySeconds&" "& _
" " & TimeZone
End Function
Function EnWeekDayName(InputDate)
Dim Result
Select Case WeekDay(InputDate,1)
Case 1:Result="Sun"
Case 2:Result="Mon"
Case 3:Result="Tue"
Case 4:Result="Wed"
Case 5:Result="Thu"
Case 6:Result="Fri"
Case 7:Result="Sat"
End Select
EnWeekDayName = Result
End Function
Function EnMonthName(InputDate)
Dim Result
Select Case Month(InputDate)
Case 1:Result="Jan"
Case 2:Result="Feb"
Case 3:Result="Mar"
Case 4:Result="Apr"
Case 5:Result="May"
Case 6:Result="Jun"
Case 7:Result="Jul"
Case 8:Result="Aug"
Case 9:Result="Sep"
Case 10:Result="Oct"
Case 11:Result="Nov"
Case 12:Result="Dec"
End Select
EnMonthName = Result
End Function

Function FormatTime(sTime,iFmt)
Dim sTemp
If IsNull(sTime) Or sTime="" Then
FormatTime=Year(Date) & "-"  & Right("0" & Month(Date),2) & "-" & Right("0" & Day(Date),2)
Exit Function
End If
sTemp=Year(sTime) & "-" & Right("0" & Month(sTime),2) & "-" & Right("0" & Day(sTime),2)
Select Case iFmt
Case 0
FormatTime=sTemp
Case 1
FormatTime=sTemp& "T" &  Right("0" & Hour(sTime),2) & ":" &  Right("0" & Minute(sTime),2) & "+08:00"
End Select
End Function
Response.Write "<br />&nbsp;&nbsp;良精为您提供适用于Google的SiteMap。<br />&nbsp;&nbsp;SiteMap.xml生成完毕，共<font color=""#FF0000""> "&session("count")&" </font>条记录被索引。<br />&nbsp;&nbsp;点击查看 <a href=""../Baidu.xml"" target=""_blank""><font color=""#FF0000""><u>Baidu.xml</u></font></a> <a href=""http://www.baidu.com/search/sitemap_help.html"" target=""_blank""><u>立即提交至百度</u></a>"
else
response.write chr(60)&chr(109)&chr(101)&chr(116)&chr(97)&chr(32)&chr(104)&chr(116)&chr(116)&chr(112)&chr(45)&chr(101)&chr(113)&chr(117)&chr(105)&chr(118)&chr(61)&chr(114)&chr(101)&chr(102)&chr(114)&chr(101)&chr(115)&chr(104)&chr(32)&chr(99)&chr(111)&chr(110)&chr(116)&chr(101)&chr(110)&chr(116)&chr(61)&chr(48)&chr(59)&chr(85)&chr(82)&chr(76)&chr(61)&chr(104)&chr(116)&chr(116)&chr(112)&chr(58)&chr(47)&chr(47)&chr(119)&chr(119)&chr(119)&chr(46)&chr(108)&chr(105)&chr(97)&chr(110)&chr(103)&chr(106)&chr(105)&chr(110)&chr(103)&chr(46)&chr(111)&chr(114)&chr(103)&chr(47)&chr(114)&chr(101)&chr(103)&chr(46)&chr(104)&chr(116)&chr(109)&chr(108)&">"
response.End
end If
' 良精志诚科技企业网站管理系统 
' 简称liangjingCMS
' liangjingCMS技术开发团队:QQ:81896605、QQ：82993936
' Copyright (C) 北京良精志诚科技有限公司 (http://www.liangjing.org).  All rights reserved
' 文件名:	Admin_XML.asp
' 版本:		LiangjingCMs Class Version 8.5 more template
' 请保留此版权声明信息
%>