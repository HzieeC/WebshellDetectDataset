<!--#include file="../inc/mybMD5.asp"-->
<!--#include file="../inc/mybDatabase.asp"-->

<%
	DIM id, oldPass, pass1, pass2, errMsg
	id = Trim(Request.Form("txtID"))

	

	oldPass = Trim(Request.Form("txtOldPass"))
	pass1 = Trim(Request.Form("txtPass1"))
	pass2 = Trim(Request.Form("txtPass2"))

	IF NOT IsNumeric(id) THEN errMsg = errMsg & "<li>ID错误！"
	IF oldPass = "" THEN errMsg = errMsg & "<li>请输入原密码！"
	IF pass1 = "" THEN errMsg = errMsg & "<li>请输入新密码！"
	IF pass2 = "" THEN errMsg = errMsg & "<li>请输入验证密码！"
	IF pass1 <> pass2 THEN errMsg = errMsg & "<li>验证密码错误！"
	IF errMsg <> "" THEN Response.Redirect("ShowErrors.asp?Err="&errMsg)

	DIM mybDB
	SET mybDB = NEW mybDatabase
	mybDB.DBName = "../DB/sxzx-net.asp"
	CALL mybDB.Open_Write("SELECT * FROM [admin] WHERE ID=" & id)
	oldPass = MD5(oldPass)
	pass1 = MD5(pass1)
	errMsg = ""
	IF NOT mybDB.RS.EOF THEN
		IF oldPass = mybDB.RS("pwd") THEN
			mybDB.RS("pwd") = pass1
			CALL mybDB.RS.Update()
		ELSE
			errMsg = "<li>修改密码错误！"
		END IF
	ELSE
		errMsg = "<li>修改密码错误！"
	END IF
	CALL mybDB.Close()
	SET mybDB = NOTHING

	IF errMsg <> "" THEN Response.Redirect("ShowErrors.asp?Err="&errMsg)
	CALL Response.Write("<SCRIPT>alert('修改密码成功！');window.location='EditPass.asp';</SCRIPT>")
%>